<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rodolfo Viegas de Albuquerque">
<meta name="author" content="Prof.&nbsp;Dr.&nbsp;João Fausto Lorenzato de Oliveira">

<title>Análise de Dados dos combinatores Média, Mediana, SVR-Stack e Média Ponderada por Features Importance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="relatorio_files/libs/clipboard/clipboard.min.js"></script>
<script src="relatorio_files/libs/quarto-html/quarto.js"></script>
<script src="relatorio_files/libs/quarto-html/popper.min.js"></script>
<script src="relatorio_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="relatorio_files/libs/quarto-html/anchor.min.js"></script>
<link href="relatorio_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="relatorio_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="relatorio_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="relatorio_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="relatorio_files/libs/bootstrap/bootstrap-d47b1ef76e95a00d0033587c94af7037.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="relatorio_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="relatorio_files/libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<script src="relatorio_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="relatorio_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="relatorio_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">1</span> Introdução</a></li>
  <li><a href="#primeiro-olhar-aos-dados" id="toc-primeiro-olhar-aos-dados" class="nav-link" data-scroll-target="#primeiro-olhar-aos-dados"><span class="header-section-number">2</span> Primeiro Olhar aos Dados</a></li>
  <li><a href="#diagrama-do-sistema-de-treino-e-teste" id="toc-diagrama-do-sistema-de-treino-e-teste" class="nav-link" data-scroll-target="#diagrama-do-sistema-de-treino-e-teste"><span class="header-section-number">3</span> Diagrama do sistema de treino e teste</a></li>
  <li><a href="#análise-por-agrupamento-group-by" id="toc-análise-por-agrupamento-group-by" class="nav-link" data-scroll-target="#análise-por-agrupamento-group-by"><span class="header-section-number">4</span> Análise por Agrupamento (Group by)</a>
  <ul class="collapse">
  <li><a href="#agrupamento-por-série-e-número-de-modelos" id="toc-agrupamento-por-série-e-número-de-modelos" class="nav-link" data-scroll-target="#agrupamento-por-série-e-número-de-modelos"><span class="header-section-number">4.1</span> Agrupamento por série e número de modelos</a></li>
  <li><a href="#série-n1402-n1411-n1501-n2401-e-n2402-macro" id="toc-série-n1402-n1411-n1501-n2401-e-n2402-macro" class="nav-link" data-scroll-target="#série-n1402-n1411-n1501-n2401-e-n2402-macro"><span class="header-section-number">4.2</span> Série N1402, N1411, N1501, N2401 e N2402 &amp;MACRO</a></li>
  <li><a href="#agrupamento-do-número-de-modelos-independente-da-série-por-valor-rmse-e-smape" id="toc-agrupamento-do-número-de-modelos-independente-da-série-por-valor-rmse-e-smape" class="nav-link" data-scroll-target="#agrupamento-do-número-de-modelos-independente-da-série-por-valor-rmse-e-smape"><span class="header-section-number">4.3</span> Agrupamento do número de modelos, independente da série, por valor RMSE e SMAPE</a></li>
  </ul></li>
  <li><a href="#análise-de-teste-de-hipótese-friedmannemenyi" id="toc-análise-de-teste-de-hipótese-friedmannemenyi" class="nav-link" data-scroll-target="#análise-de-teste-de-hipótese-friedmannemenyi"><span class="header-section-number">5</span> Análise de Teste de Hipótese Friedman/Nemenyi</a></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Análise de Dados dos combinatores Média, Mediana, SVR-Stack e Média Ponderada por <em>Features Importance</em></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Código</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Mostrar o código</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Esconder o código</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">Ver o código fonte</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Autores</div>
  <div class="quarto-title-meta-heading">Afiliação</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Rodolfo Viegas de Albuquerque </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Universidade de Pernambuco
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Prof.&nbsp;Dr.&nbsp;João Fausto Lorenzato de Oliveira </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Universidade de Pernambuco
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Data de Publicação</div>
    <div class="quarto-title-meta-contents">
      <p class="date">10 de abril de 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
p {
  text-indent: 30px;
  text-align:justify
}
</style>
<div id="3709d775" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autorank <span class="im">import</span> autorank, create_report, plot_stats</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.m3 <span class="im">import</span> M3</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>Y_df, _, _ <span class="op">=</span> M3.load(directory<span class="op">=</span><span class="st">"./data/monthly"</span>, group<span class="op">=</span><span class="st">"Monthly"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>unique_ids <span class="op">=</span> Y_df[<span class="st">"unique_id"</span>].unique()[:<span class="dv">30</span>]</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introdução" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">1</span> Introdução</h2>
<p>Este relatório é faz a análise prelimilinar dos dados obtidos com o sistema de treino e teste para os quatro combinadores de modelos para tarefas de previsão de séries temporais. O objetivo principal aqui é gerar tabelas e grásficos de agrupapamentos para, então, escrever anotações que serão usadas na escrita do artigo.</p>
</section>
<section id="primeiro-olhar-aos-dados" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="primeiro-olhar-aos-dados"><span class="header-section-number">2</span> Primeiro Olhar aos Dados</h2>
<p>Há três conjuntos de dados pós-execução do sistema: 2 arquivos de resultados de tipo csv paras as métricas RMSE e SMAPE, e 1 com todas as predições dos modelos e suas combinações. Abaixo as cinco primeiras linhas de cada conjunto de dados:</p>
<div class="cell" data-execution_count="2" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> pd.read_csv(<span class="st">'./monthly_model_sensitivity_rmse_results.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'/home/rodolfoviegas/projetos/analise_sensibilidade_fi/analise_sensi/data/monthly_model_sensitivity_rmse_results.csv'</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rmse.head()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="2">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th">models_used</th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>M1</td>
<td>1</td>
<td>rf</td>
<td>1538.789241</td>
<td>1538.789241</td>
<td>1538.789241</td>
<td>1538.789241</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M1</td>
<td>1</td>
<td>mlp</td>
<td>2971.694096</td>
<td>2971.694096</td>
<td>2971.694096</td>
<td>2971.694096</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>M1</td>
<td>1</td>
<td>knn</td>
<td>1543.846900</td>
<td>1543.846900</td>
<td>1543.846900</td>
<td>1543.846900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>M1</td>
<td>1</td>
<td>svr</td>
<td>1804.757123</td>
<td>1804.757123</td>
<td>1804.757123</td>
<td>1804.757123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>M1</td>
<td>1</td>
<td>arima</td>
<td>2055.890114</td>
<td>2055.890114</td>
<td>2055.890114</td>
<td>2055.890114</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;1: All RMSE values for all models and their combination for all time series
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="3" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>smape <span class="op">=</span> pd.read_csv(<span class="st">'./monthly_model_sensitivity_smape_results.csv'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>smape.head()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="3">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th">models_used</th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>M1</td>
<td>1</td>
<td>rf</td>
<td>61.885443</td>
<td>61.885443</td>
<td>61.885443</td>
<td>61.885443</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>M1</td>
<td>1</td>
<td>mlp</td>
<td>158.173465</td>
<td>158.173465</td>
<td>158.173465</td>
<td>158.173465</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>M1</td>
<td>1</td>
<td>knn</td>
<td>56.733267</td>
<td>56.733267</td>
<td>56.733267</td>
<td>56.733267</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>M1</td>
<td>1</td>
<td>svr</td>
<td>69.638085</td>
<td>69.638085</td>
<td>69.638085</td>
<td>69.638085</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>M1</td>
<td>1</td>
<td>arima</td>
<td>76.284221</td>
<td>76.284221</td>
<td>76.284221</td>
<td>76.284221</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;2: All SMAPE values for all models and their combination for all time series
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="4" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> pd.read_excel(<span class="st">'./monthly_model_predictions.xlsx'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>preds.head()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-observations" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-observations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">using</th>
<th data-quarto-table-cell-role="th">series</th>
<th data-quarto-table-cell-role="th">rf</th>
<th data-quarto-table-cell-role="th">mlp</th>
<th data-quarto-table-cell-role="th">knn</th>
<th data-quarto-table-cell-role="th">svr</th>
<th data-quarto-table-cell-role="th">arima</th>
<th data-quarto-table-cell-role="th">ets</th>
<th data-quarto-table-cell-role="th">theta</th>
<th data-quarto-table-cell-role="th">tbats</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">fi_avg_mlp_tbats</th>
<th data-quarto-table-cell-role="th">stack_mlp_tbats</th>
<th data-quarto-table-cell-role="th">mean_arima_ets</th>
<th data-quarto-table-cell-role="th">median_arima_ets</th>
<th data-quarto-table-cell-role="th">fi_avg_arima_ets</th>
<th data-quarto-table-cell-role="th">stack_arima_ets</th>
<th data-quarto-table-cell-role="th">mean_arima_theta</th>
<th data-quarto-table-cell-role="th">median_arima_theta</th>
<th data-quarto-table-cell-role="th">fi_avg_arima_theta</th>
<th data-quarto-table-cell-role="th">stack_arima_theta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>train</td>
<td>2640</td>
<td>2588.730476</td>
<td>-558.849183</td>
<td>3060.0</td>
<td>3073.051092</td>
<td>3609.6</td>
<td>3611.015634</td>
<td>2640.000000</td>
<td>2640.000000</td>
<td>...</td>
<td>1047.012732</td>
<td>2640.099821</td>
<td>3610.307817</td>
<td>3610.307817</td>
<td>3611.015634</td>
<td>3038.223500</td>
<td>3124.800000</td>
<td>3124.800000</td>
<td>2640.000000</td>
<td>2640.100487</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>train</td>
<td>2640</td>
<td>2588.730476</td>
<td>-558.849183</td>
<td>3060.0</td>
<td>3073.051092</td>
<td>3609.6</td>
<td>3610.918533</td>
<td>3790.979396</td>
<td>3790.979396</td>
<td>...</td>
<td>1624.818646</td>
<td>2640.100209</td>
<td>3610.259266</td>
<td>3610.259266</td>
<td>3610.918533</td>
<td>3044.307277</td>
<td>3700.289698</td>
<td>3700.289698</td>
<td>3790.979396</td>
<td>2640.099804</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>train</td>
<td>2160</td>
<td>2588.730476</td>
<td>-558.849183</td>
<td>3060.0</td>
<td>3073.051092</td>
<td>3609.6</td>
<td>3610.821441</td>
<td>3675.881456</td>
<td>3675.881456</td>
<td>...</td>
<td>1567.038054</td>
<td>2160.099710</td>
<td>3610.210720</td>
<td>3610.210720</td>
<td>3610.821441</td>
<td>3050.384369</td>
<td>3642.740728</td>
<td>3642.740728</td>
<td>3675.881456</td>
<td>2242.920743</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>train</td>
<td>4200</td>
<td>3581.157143</td>
<td>-449.171176</td>
<td>3200.0</td>
<td>3212.921128</td>
<td>3609.6</td>
<td>3610.676359</td>
<td>3524.293310</td>
<td>3524.293310</td>
<td>...</td>
<td>1545.557216</td>
<td>4127.137819</td>
<td>3610.138179</td>
<td>3610.138179</td>
<td>3610.676359</td>
<td>3059.446510</td>
<td>3566.946655</td>
<td>3566.946655</td>
<td>3524.293310</td>
<td>2906.405292</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>train</td>
<td>3360</td>
<td>3002.956190</td>
<td>-929.949214</td>
<td>3140.0</td>
<td>2784.679624</td>
<td>3609.6</td>
<td>3610.735291</td>
<td>3591.863979</td>
<td>3591.863979</td>
<td>...</td>
<td>1340.057021</td>
<td>3359.899635</td>
<td>3610.167645</td>
<td>3610.167645</td>
<td>3610.735291</td>
<td>3055.768750</td>
<td>3600.731990</td>
<td>3600.731990</td>
<td>3591.863979</td>
<td>3122.091029</td>
</tr>
</tbody>
</table>

<p>5 rows × 2019 columns</p>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-observations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;3: All observations labeled as train, val, and test for all models and their combination for all time series
</figcaption>
</figure>
</div>
</div>
<p>Ao todo foram 30 séries temporais mensais — período sasonal igual a 12 — as quais foram usadas na competição de <em>forecasting</em> M3. No obstante serem dados bastante conhecidos, usados <em>benchmarking</em>, não se sabe seus nomes, mas sim os contextos cujos os dados foram extraídos. São esses: finanças, economia, demografia, indústria e outros.</p>
</section>
<section id="diagrama-do-sistema-de-treino-e-teste" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="diagrama-do-sistema-de-treino-e-teste"><span class="header-section-number">3</span> Diagrama do sistema de treino e teste</h2>
<p>O sistema e cria combinações para cada operador começando com 2 métodos até 9 reunídos, o algoritmo <a href="#alg-comb" class="quarto-xref">Algorithm 1</a> abaixo descreve o processo:</p>
<div id="alg-comb" class="pseudocode-container quarto-float" data-comment-delimiter="//" data-caption-prefix="Algorithm" data-line-number-punc=":" data-line-number="true" data-no-end="false" data-pseudocode-number="1" data-indent-size="1.2em">
<div class="pseudocode">
\begin{algorithm} \caption{Combinations}\begin{algorithmic} \For{$i \gets 1$ to $30$} \State $ Predictions \gets Training(Statiscal Models, Y_{train}^{i})$ \State $Predictions \gets Training(ML Models, Y_{train}^{i})$ \For{$j \gets 9$ to $2$} \State $Combinations \gets C_j^{9}$ \State $Operators(Combinations, Predictions)$ \EndFor \EndFor \end{algorithmic} \end{algorithm}
</div>
</div>
<p>A função <em>combination</em> dentro do algoritmo é um combinação para garantir que não haja repetições de <em>ensembles</em>, a equação a descreve:</p>
<p><span class="math display">\[
C_j^{9} = \frac{9!}{j!(9-j)!}
\]</span></p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-diagrama" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-diagrama-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-diagrama">flowchart TD
  A((Start)) --&gt; B[(Time Series)]
  B --&gt; C[Training Set]
  B --&gt; D[Test Set]
  C --&gt; E[Single Models]
  E --&gt; F[Combinations]
  F --&gt; D
  D --&gt; G[Evaluation]
  G --&gt; H((End))

</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diagrama-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Diagrama de Treino
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análise-por-agrupamento-group-by" class="level2 page-columns page-full" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="análise-por-agrupamento-group-by"><span class="header-section-number">4</span> Análise por Agrupamento (Group by)</h2>
<section id="agrupamento-por-série-e-número-de-modelos" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="agrupamento-por-série-e-número-de-modelos"><span class="header-section-number">4.1</span> Agrupamento por série e número de modelos</h3>
<p>A <a href="#tbl-agg_rmse_mean" class="quarto-xref">Tabela&nbsp;4</a> mostra um agrupamento das séries tratadas e do valor médio de RSME pela quantidade de modelos — até 9 modelos — nos <em>ensembles</em> para os quatro operadores analidados:</p>
<div class="cell" data-execution_count="5" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mean_rmse_series_models <span class="op">=</span> rmse.groupby([<span class="st">'dataset'</span>,<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].mean()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mean_rmse_series_models.head(<span class="dv">18</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-agg_rmse_mean" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="5">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-agg_rmse_mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="9" data-quarto-table-cell-role="th" data-valign="top">M1</td>
<td data-quarto-table-cell-role="th">1</td>
<td>1974.986301</td>
<td>1974.986301</td>
<td>1974.986301</td>
<td>1974.986301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1770.740250</td>
<td>1770.740250</td>
<td>1758.379564</td>
<td>1791.460625</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1685.277191</td>
<td>1790.402156</td>
<td>1645.521860</td>
<td>1745.397255</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1640.805186</td>
<td>1739.003101</td>
<td>1601.239990</td>
<td>1717.897451</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1614.236385</td>
<td>1780.502999</td>
<td>1582.558450</td>
<td>1708.139353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>1596.760782</td>
<td>1743.231210</td>
<td>1572.542312</td>
<td>1705.821790</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1584.455010</td>
<td>1782.866886</td>
<td>1567.674926</td>
<td>1705.115537</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1575.345087</td>
<td>1747.335906</td>
<td>1566.109079</td>
<td>1705.056780</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1568.340074</td>
<td>1849.635294</td>
<td>1563.561165</td>
<td>1705.056780</td>
</tr>
<tr class="even">
<td rowspan="9" data-quarto-table-cell-role="th" data-valign="top">M10</td>
<td data-quarto-table-cell-role="th">1</td>
<td>856.816143</td>
<td>856.816143</td>
<td>856.816143</td>
<td>856.816143</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>800.525384</td>
<td>800.525384</td>
<td>801.864886</td>
<td>851.850009</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>782.224949</td>
<td>841.570106</td>
<td>784.939689</td>
<td>849.847686</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>773.135659</td>
<td>819.003701</td>
<td>777.042755</td>
<td>849.366708</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>767.718451</td>
<td>842.212597</td>
<td>769.271070</td>
<td>849.298904</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>764.128996</td>
<td>828.168258</td>
<td>764.043863</td>
<td>849.256123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>761.578978</td>
<td>842.194783</td>
<td>756.919705</td>
<td>849.256123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>759.675545</td>
<td>833.516734</td>
<td>743.206099</td>
<td>849.256123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>758.201231</td>
<td>853.638584</td>
<td>748.593621</td>
<td>849.256123</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-agg_rmse_mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;4: Group of mean RMSE value for all time series e number of model in all ensembles.
</figcaption>
</figure>
</div>
</div>
<p>Abaixo a <a href="#tbl-agg_smape_mean" class="quarto-xref">Tabela&nbsp;5</a> apresenta o agrupamento de séries por valor médio da métrica SMAPE pelo número de modelos combinados para os quatro operadores de combinação:</p>
<div class="cell" data-execution_count="6" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mean_smape_series_models <span class="op">=</span> smape.groupby([<span class="st">'dataset'</span>,<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].mean()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mean_smape_series_models.head(<span class="dv">18</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-agg_smape_mean" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-agg_smape_mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">dataset</th>
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="9" data-quarto-table-cell-role="th" data-valign="top">M1</td>
<td data-quarto-table-cell-role="th">1</td>
<td>80.100359</td>
<td>80.100359</td>
<td>80.100359</td>
<td>80.100359</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>70.361482</td>
<td>70.361482</td>
<td>69.882947</td>
<td>70.248925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>66.707401</td>
<td>69.134651</td>
<td>65.004136</td>
<td>69.869757</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>65.440386</td>
<td>69.031598</td>
<td>63.616016</td>
<td>69.465386</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>65.097537</td>
<td>69.554552</td>
<td>63.223797</td>
<td>69.267055</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>64.965552</td>
<td>69.733712</td>
<td>62.992327</td>
<td>69.211450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>64.918379</td>
<td>70.447524</td>
<td>62.914311</td>
<td>69.194280</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>64.902712</td>
<td>70.631853</td>
<td>62.980855</td>
<td>69.192822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>64.989620</td>
<td>72.686292</td>
<td>63.084541</td>
<td>69.192822</td>
</tr>
<tr class="even">
<td rowspan="9" data-quarto-table-cell-role="th" data-valign="top">M10</td>
<td data-quarto-table-cell-role="th">1</td>
<td>16.707655</td>
<td>16.707655</td>
<td>16.707655</td>
<td>16.707655</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>15.625032</td>
<td>15.625032</td>
<td>15.518295</td>
<td>16.628689</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>15.257100</td>
<td>16.383284</td>
<td>15.147801</td>
<td>16.636357</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>15.061166</td>
<td>15.947136</td>
<td>14.970955</td>
<td>16.630711</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>14.931235</td>
<td>16.482167</td>
<td>14.806498</td>
<td>16.630153</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>14.857642</td>
<td>16.214421</td>
<td>14.721499</td>
<td>16.629385</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>14.813940</td>
<td>16.592615</td>
<td>14.597606</td>
<td>16.629385</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>14.807747</td>
<td>16.452184</td>
<td>14.350677</td>
<td>16.629385</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>14.771671</td>
<td>16.666796</td>
<td>14.525133</td>
<td>16.629385</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-agg_smape_mean-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;5: Group of mean SMAPE value for all time series e number of model in all ensembles.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="série-n1402-n1411-n1501-n2401-e-n2402-macro" class="level3 page-columns page-full" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="série-n1402-n1411-n1501-n2401-e-n2402-macro"><span class="header-section-number">4.2</span> Série N1402, N1411, N1501, N2401 e N2402 &amp;MACRO</h3>
<p>Análise de dados das séries N1402 MICRO, N1411 MICRO, N1501 MICRO, N2401 MACRO e N2402 MACRO</p>
<section id="n1402" class="level4" data-number="4.2.1">
<h4 data-number="4.2.1" class="anchored" data-anchor-id="n1402"><span class="header-section-number">4.2.1</span> N1402</h4>
<section id="análise-geral-dos-ensembles-da-série-n1402" class="level5" data-number="4.2.1.1">
<h5 data-number="4.2.1.1" class="anchored" data-anchor-id="análise-geral-dos-ensembles-da-série-n1402"><span class="header-section-number">4.2.1.1</span> Análise Geral dos <em>Ensembles</em> da Série N1402</h5>
<p>Abaixo na figura <a href="#fig-n1402-series" class="quarto-xref">Figura&nbsp;2</a> a série da categoria micro N1402 com 68 observações, sendo que as 18 últimas são para teste. O gráfico a expõe com divisão para treino e teste.</p>
<div id="cell-fig-n1402-series" class="cell fig-cap-location-bottom" data-execution_count="7">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb7" data-cap-location="bottom"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m1.ds[:<span class="op">-</span><span class="dv">18</span>], m1.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ax.plot(m1.ds[<span class="op">-</span><span class="dv">18</span>:], m1.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-n1402-series" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="bottom">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n1402-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1402-series-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1402-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: N1402 MICRO Time Series
</figcaption>
</figure>
</div>
</div>
</div>
<p>Em relação a série histórica N1402 é claro o fato de que <em>ensembles</em> contribuem para maior acurácia, a partir dois modelos combinados os valores de RMSE e de SMAPE começam a cair. O destaque se dá aos combinadores média simples e média ponderada por <em>features importance</em> para as duas métricas que são superiores quando comparados à mediana e ao stacking. A média ponderada — para ambas métrica — cai mais rápido que os valores da média simples nos primeiros modelos combinados; quando analisada a métrica RMSE há uma aparente convergência de valores a partir de 6 modelos no <em>ensemble</em>, quando há estabilização dos resultados para a média ponderada. Já para a métrica SMAPE não há uma convergência aparente, mas uma correlação muito forte entre os valores, os quais pioram tanto para média aritmética quanto média ponderada na combinação de 9 métodos.</p>
<div class="cell" data-execution_count="8" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rmse_m1 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1'</span>,:]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rmse_m1</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse_mean_n1402" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="8">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse_mean_n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1974.986301</td>
<td>1974.986301</td>
<td>1974.986301</td>
<td>1974.986301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1770.740250</td>
<td>1770.740250</td>
<td>1758.379564</td>
<td>1791.460625</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1685.277191</td>
<td>1790.402156</td>
<td>1645.521860</td>
<td>1745.397255</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1640.805186</td>
<td>1739.003101</td>
<td>1601.239990</td>
<td>1717.897451</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1614.236385</td>
<td>1780.502999</td>
<td>1582.558450</td>
<td>1708.139353</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>1596.760782</td>
<td>1743.231210</td>
<td>1572.542312</td>
<td>1705.821790</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1584.455010</td>
<td>1782.866886</td>
<td>1567.674926</td>
<td>1705.115537</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1575.345087</td>
<td>1747.335906</td>
<td>1566.109079</td>
<td>1705.056780</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1568.340074</td>
<td>1849.635294</td>
<td>1563.561165</td>
<td>1705.056780</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse_mean_n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;6: Group of average RMSE value for the M1 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="9" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>smape_m1 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1'</span>,:]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>smape_m1</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape_mean_n1402" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="9">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape_mean_n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>80.100359</td>
<td>80.100359</td>
<td>80.100359</td>
<td>80.100359</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>70.361482</td>
<td>70.361482</td>
<td>69.882947</td>
<td>70.248925</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>66.707401</td>
<td>69.134651</td>
<td>65.004136</td>
<td>69.869757</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>65.440386</td>
<td>69.031598</td>
<td>63.616016</td>
<td>69.465386</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>65.097537</td>
<td>69.554552</td>
<td>63.223797</td>
<td>69.267055</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>64.965552</td>
<td>69.733712</td>
<td>62.992327</td>
<td>69.211450</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>64.918379</td>
<td>70.447524</td>
<td>62.914311</td>
<td>69.194280</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>64.902712</td>
<td>70.631853</td>
<td>62.980855</td>
<td>69.192822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>64.989620</td>
<td>72.686292</td>
<td>63.084541</td>
<td>69.192822</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape_mean_n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;7: Group of average SMAPE value for the M1 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<p>Os melhores valores médios de RMSE para média aritmética e média ponderada são 1568,34 e 1563,56 respectivamente e com 9 métodos combinados para ambos. Com respeito à SMAPE os mehores valores médio acontecem quando há 8 modelos combinados para média aritmética, 64.902, e 62.914 para a média ponderada por <em>features importance</em> quando a combinação é composta por 7 modelos.</p>
<div class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n1402" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="10">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div id="fig-n1402-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n1402-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1402-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-n1402">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1402-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) RMSE
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-n1402-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n1402-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1402-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-n1402">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1402-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) SMAPE
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Average RMSE and SMAPE values for all combination operators used on N1402 series.
</figcaption>
</figure>
</div>
</div>
<p>A mediana, que geralmente tem resultados melhores que a média simples, por ser mais robusta a distribuições assimétricas e <em>outliers</em> não foi tão bem, tendo seu melhor resultado com 4 modelos para a métrica RSME ficando com 1739.003, e piorando ao passo que o número de elementos aumenta. O valor médio da métrica SMAPE mais acurádo é 69.031 novamente para combinação de 4 modelos.</p>
<p>Já a técnica de stacking por SVR melhorou a acurácia quando comparada aos modelos individuais, mas parou de evoluir a partir de 6 métodos na combinação.</p>
</section>
<section id="análise-dos-melhores-métodos-da-série-n1402" class="level5" data-number="4.2.1.2">
<h5 data-number="4.2.1.2" class="anchored" data-anchor-id="análise-dos-melhores-métodos-da-série-n1402"><span class="header-section-number">4.2.1.2</span> Análise dos melhores métodos da série N1402</h5>
<p>Quando analisadas individuamente, a melhor combinação para para a série M1 é o STACKING de SVR. O valor de RMSE <a href="#tbl-best_model_n1402_rmse" class="quarto-xref">Tabela&nbsp;8</a> dessa é 1293,006 e 1438,399 para a média ponderada por <em>features importance</em>, a segunda melhor. Usando o cálculo de <em>percentual improvement</em> <span class="math inline">\(Percentual Improvement = \frac{Error1 - Error2}{Error1} * 100\)</span>, temos que há uma melhoria de -10.108%. Já para a métrica SMAPE <a href="#tbl-best_model_n1402_smape" class="quarto-xref">Tabela&nbsp;9</a>, o valor para Stack é 50,78 e 53,248 para média aritmética, houve uma melhoria percentual de acurácia de -4,621%.</p>
<div class="cell" data-execution_count="11" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1402_rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="11">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1402_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RF MLP KNN THETA TBATS</td>
<td>RF MLP KNN</td>
<td>MLP KNN ARIMA THETA TBATS</td>
<td>ARIMA CES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1455.53107</td>
<td>1439.518276</td>
<td>1438.399159</td>
<td>1293.006569</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1402_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;8: The Best models for M1 series for RMSE metric
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="12" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>best_models_smape</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1402_smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="12">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1402_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RF MLP KNN THETA</td>
<td>RF MLP KNN</td>
<td>MLP KNN THETA</td>
<td>ARIMA CES</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>55.196953</td>
<td>53.248072</td>
<td>53.785497</td>
<td>50.78712</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1402_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;9: The Best models for N1402 series for SMAPE metric
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="n1411" class="level4" data-number="4.2.2">
<h4 data-number="4.2.2" class="anchored" data-anchor-id="n1411"><span class="header-section-number">4.2.2</span> N1411</h4>
<section id="análise-geral-dos-ensembles-da-série-n1411" class="level5" data-number="4.2.2.1">
<h5 data-number="4.2.2.1" class="anchored" data-anchor-id="análise-geral-dos-ensembles-da-série-n1411"><span class="header-section-number">4.2.2.1</span> Análise Geral dos <em>Ensembles</em> da Série N1411</h5>
<p>Na figura <a href="#fig-n1411-series" class="quarto-xref">Figura&nbsp;4</a> a série MICRO N1411 dividida em dois conjuntos de treino e de teste.</p>
<div id="cell-fig-n1411-series" class="cell fig-cap-location-bottom" data-execution_count="13">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb13" data-cap-location="bottom"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>m10 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M10'</span>]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m10.ds[:<span class="op">-</span><span class="dv">18</span>], m10.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>ax.plot(m10.ds[<span class="op">-</span><span class="dv">18</span>:], m10.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-n1411-series" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="bottom">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n1411-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1411-series-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1411-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: N1411 MICRO Time Series
</figcaption>
</figure>
</div>
</div>
</div>
<p>Na série N1411, as combinações obtiveram resultados bons quando considerada a métrica RMSE (<a href="#tbl-rmse_mean_n1411" class="quarto-xref">Tabela&nbsp;10</a>). Semelhante à série N1402, as combinações de média ponderada e média aritmética tiveram, em média, os melhores resultados. A média dos erros mais baixa para média simple é de 758,201 e se deu com 9 modelos combinados; já para a média ponderada, o valor médio do erro mais baixo foi 743,206 e ocorreu com 8 métodos combinados. O operador mediana foi mais acurado que svr-stacking, este manteve-se estável em performance a partir de 3 modelos, ou seja, sem melhorias ou pioras. Já mediana ocilou bastante crescendo e diminuindo o error ao passo que mais modelos foram acrescentados.</p>
<div class="cell" data-execution_count="14" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rmse_m10 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M10'</span>,:]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rmse_m10</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse_mean_n1411" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="14">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse_mean_n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>856.816143</td>
<td>856.816143</td>
<td>856.816143</td>
<td>856.816143</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>800.525384</td>
<td>800.525384</td>
<td>801.864886</td>
<td>851.850009</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>782.224949</td>
<td>841.570106</td>
<td>784.939689</td>
<td>849.847686</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>773.135659</td>
<td>819.003701</td>
<td>777.042755</td>
<td>849.366708</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>767.718451</td>
<td>842.212597</td>
<td>769.271070</td>
<td>849.298904</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>764.128996</td>
<td>828.168258</td>
<td>764.043863</td>
<td>849.256123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>761.578978</td>
<td>842.194783</td>
<td>756.919705</td>
<td>849.256123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>759.675545</td>
<td>833.516734</td>
<td>743.206099</td>
<td>849.256123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>758.201231</td>
<td>853.638584</td>
<td>748.593621</td>
<td>849.256123</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse_mean_n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;10: Group of average RMSE value for the N1411 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<p>Em relação a métrica SMAPE <a href="#tbl-smape_mean_n1411" class="quarto-xref">Tabela&nbsp;11</a>, o resultado foi muito semelhante à merica RMSE. Média aritmética e média ponderada obtiveram melhores resultados quanto mais modelos são acrescentados à combinação. A média ponderada for <em>features importances</em> conseguiu o melhor resultados médio com 8 métodos obtendo 14,35 de SMAPE médio, mas e voltou a crescer quando um modelo é adicionado. A média simples descresce o erro SMAPE médio quanto mais modelos são acrescentados, tendo seu erro médio mais baixo com nove métodos combinados. Os valores médios de SMAPE para svr-stacking também permaneceram estáveis ao número de 3 métodos e a mediana novamente com muita ocialação, mas conseguindo escore mais acurado quando comparada ao svr-stacking.</p>
<div class="cell" data-execution_count="15" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>smape_m10 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M10'</span>,:]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>smape_m10</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape_mean_n1411" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="15">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape_mean_n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>16.707655</td>
<td>16.707655</td>
<td>16.707655</td>
<td>16.707655</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>15.625032</td>
<td>15.625032</td>
<td>15.518295</td>
<td>16.628689</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>15.257100</td>
<td>16.383284</td>
<td>15.147801</td>
<td>16.636357</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>15.061166</td>
<td>15.947136</td>
<td>14.970955</td>
<td>16.630711</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>14.931235</td>
<td>16.482167</td>
<td>14.806498</td>
<td>16.630153</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>14.857642</td>
<td>16.214421</td>
<td>14.721499</td>
<td>16.629385</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>14.813940</td>
<td>16.592615</td>
<td>14.597606</td>
<td>16.629385</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>14.807747</td>
<td>16.452184</td>
<td>14.350677</td>
<td>16.629385</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>14.771671</td>
<td>16.666796</td>
<td>14.525133</td>
<td>16.629385</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape_mean_n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;11: Group of average SMAPE value for the N1411 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n1411" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="16">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div id="fig-n1411-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n1411-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1411-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-n1411">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1411-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) RMSE
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-n1411-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n1411-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1411-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-n1411">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1411-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) SMAPE
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1411-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Average RMSE and SMAPE values for all combination operators used on N1411 series.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="análise-dos-melhores-métodos-da-série-n1411" class="level5" data-number="4.2.2.2">
<h5 data-number="4.2.2.2" class="anchored" data-anchor-id="análise-dos-melhores-métodos-da-série-n1411"><span class="header-section-number">4.2.2.2</span> Análise dos melhores métodos da série N1411</h5>
<p>O melhor modelos dentre todos os individuais e todas as combinações foi o Random Forest, a exceção do combinador média ponderada por <em>features importance</em> na métrica RMSE, em todos os outros cenários quando comparado aos outras combinações o Random Forest sai-se melhor, tanto quando avalidado por RMSE quanto por SMAPE. É-se preciso destacar que tal modelos é um ensemble, porém uma forma homogência, <em>i.e.</em>, são várias árvores de decisão que o compõem.</p>
<div class="cell" data-execution_count="17" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1411_rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="17">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1411_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RF</td>
<td>RF</td>
<td>RF MLP</td>
<td>RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>629.180649</td>
<td>629.180649</td>
<td>628.573627</td>
<td>629.180649</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1411_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;12: The Best models for N1411 series for RMSE metric
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="18" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1411_smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="18">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1411_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RF</td>
<td>RF</td>
<td>RF</td>
<td>RF</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>11.824904</td>
<td>11.824904</td>
<td>11.824904</td>
<td>11.824904</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1411_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;13: The Best models for M10 series for SMAPE metric
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="n1501" class="level4 page-columns page-full" data-number="4.2.3">
<h4 data-number="4.2.3" class="anchored" data-anchor-id="n1501"><span class="header-section-number">4.2.3</span> N1501</h4>
<section id="análise-geral-dos-ensembles-da-série-n1501" class="level5 page-columns page-full" data-number="4.2.3.1">
<h5 data-number="4.2.3.1" class="anchored" data-anchor-id="análise-geral-dos-ensembles-da-série-n1501"><span class="header-section-number">4.2.3.1</span> Análise Geral dos <em>Ensembles</em> da Série N1501</h5>
<p>A figura <a href="#fig-n1501-series" class="quarto-xref">Figura&nbsp;6</a> mostra a série MICRO N1501 dividas em treino e teste</p>
<div id="cell-fig-n1501-series" class="cell fig-cap-location-bottom" data-execution_count="19">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb19" data-cap-location="bottom"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m100 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M100'</span>]</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m100.ds[:<span class="op">-</span><span class="dv">18</span>], m100.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ax.plot(m100.ds[<span class="op">-</span><span class="dv">18</span>:], m100.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-n1501-series" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="bottom">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n1501-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n1501-series-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1501-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: N1501 MICRO Time Series
</figcaption>
</figure>
</div>
</div>
</div>
<p>Para ambas as métricas <a href="#tbl-rmse_mean_n1501" class="quarto-xref">Tabela&nbsp;14</a> e <a href="#tbl-smape_mean_n1501" class="quarto-xref">Tabela&nbsp;15</a>, o destaque se deu ao mal desepenho do operador SVR-Stack. Em média, o valor RMSE e SMAPE piorou drasticamente já na primeira combinação com dois métodos indicando um possível <em>overfitting</em>; a partir de três métodos há uma estabilidade de do erro. A média dos valores RMSE dos modelos individuais é 619.75, já o valor RMSE médio do SVR-Stack com dois modelos usados é 1415.82, houve uma piora de 56.226%. Para para SMAPE, o valor médio modelos individuais é 9.52 e do SVR-Stack com dois métodos de 21.9, a piora foi de 56.53%.</p>
<p>Os graficos <a href="#fig-n1501-rmse" class="quarto-xref">Figura&nbsp;7</a> e <a href="#fig-n1501-rmse" class="quarto-xref">Figura&nbsp;7</a> ilustram a piora no operator. Para ambas métricas os gráficos são utilizados em escala logarítmica, no entato, dada a magnitude da média dos valores de error, ainda assim não é possível haver uma visualização clara das tendência. Sendo, então, necessária a retirada da projeção de erros do operador SVR-Stacking com o intuitito de exibir as curvas de média de erros dos demais operadores.</p>
<div class="cell" data-execution_count="20" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rmse_m100 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M100'</span>,:]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>rmse_m100</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse_mean_n1501" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="20">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse_mean_n1501-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>619.752269</td>
<td>619.752269</td>
<td>619.752269</td>
<td>619.752269</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>600.972468</td>
<td>600.972468</td>
<td>605.266201</td>
<td>1415.820181</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>594.697978</td>
<td>606.104326</td>
<td>600.605540</td>
<td>1456.629581</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>591.537634</td>
<td>598.172065</td>
<td>598.475128</td>
<td>1458.460831</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>589.631749</td>
<td>602.214220</td>
<td>597.284003</td>
<td>1458.790558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>588.356509</td>
<td>596.830590</td>
<td>596.909124</td>
<td>1458.790782</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>587.443130</td>
<td>601.875510</td>
<td>596.241995</td>
<td>1458.790782</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>586.756645</td>
<td>596.758114</td>
<td>595.761599</td>
<td>1458.790782</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>586.221811</td>
<td>597.759793</td>
<td>594.568674</td>
<td>1458.790782</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse_mean_n1501-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;14: Group of average RMSE value for the N1501 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<p>Semelhante às outras séries, os resultados de média simples e média ponderada foram os mais acurádos, e quanto mais modelos são acrescentados, o valor do RMSE e SMAPE — em média — cai. A média ponderada por <em>features importances</em> ficando com o valor de 594.568 para a métrica RMSE e 9,116 para SMAPE.</p>
<p>Com relação à média simples, houve melhora contínua ao passo que mais modelos são acrescendados. Nota-se também que há uma lacuna acentuada entre as curvas, diferentemente das séries analisadas, indicando que a média ponderada conseguiu atriuir pesos significados aos métodos e consequentemente mais poder preditivo aos <em>ensembles</em>.</p>
<div class="cell" data-execution_count="21" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>smape_m100 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M100'</span>,:]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>smape_m100</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape_mean_n1501" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="21">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape_mean_n1501-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>9.526633</td>
<td>9.526633</td>
<td>9.526633</td>
<td>9.526633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>9.218521</td>
<td>9.218521</td>
<td>9.294394</td>
<td>21.901171</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>9.110557</td>
<td>9.322539</td>
<td>9.211224</td>
<td>22.558342</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>9.065719</td>
<td>9.212660</td>
<td>9.182206</td>
<td>22.590623</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>9.048613</td>
<td>9.294809</td>
<td>9.166899</td>
<td>22.595674</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>9.037446</td>
<td>9.214378</td>
<td>9.161665</td>
<td>22.595678</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>9.030810</td>
<td>9.287357</td>
<td>9.145356</td>
<td>22.595678</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>9.021273</td>
<td>9.201373</td>
<td>9.145818</td>
<td>22.595678</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>9.018372</td>
<td>9.272146</td>
<td>9.116639</td>
<td>22.595678</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape_mean_n1501-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;15: Group of average SMAPE value for the N1501 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell page-columns page-full" data-layout-nrow="2" data-execution_count="22">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[1].set_title("Without SVR-Stacking")</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n1501-rmse" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n1501-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n1501-rmse-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n1501-rmse-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-n1501-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1501-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n1501-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n1501-rmse-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n1501-rmse-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-n1501-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1501-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1501-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Average RMSE values for all combination operators used on N1501 series.
</figcaption>
</figure>
</div>
</div>
<p>O operador mediana conseguiu resultados mais acuradas em ambas métricas quando comparados aos modelos individuais, houve ocilação ao passo que mais métodos são adicionados, mas com a clara tendência de queda, com os melhores valores médios para RMSE e SMAPE com <em>ensemble</em> de 8 modelos: RMSE igual a 596,75 e SMAPE igual a 9,20.</p>
<div class="cell page-columns page-full" data-layout-nrows="2" data-execution_count="23">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>, color<span class="op">=</span><span class="st">'mediumvioletred'</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sem stack</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n1501-smape" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-execution_count="23" data-layout-nrows="2">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-n1501-smape-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n1501-smape-output-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-n1501-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1501-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display page-columns page-full">
<div id="fig-n1501-smape-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n1501-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n1501-smape-output-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img column-page" data-ref-parent="fig-n1501-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n1501-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) With SVR-Stacking (Log Scale)
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n1501-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Average SMAPE values for all combination operators used on M100 series.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="análise-dos-melhores-métodos-da-série-n1501" class="level5" data-number="4.2.3.2">
<h5 data-number="4.2.3.2" class="anchored" data-anchor-id="análise-dos-melhores-métodos-da-série-n1501"><span class="header-section-number">4.2.3.2</span> Análise dos melhores métodos da série N1501</h5>
<p>Em relação aos melhores métodos para a série N1501, para a métrica RMSE o melhor <em>ensemble</em> foi a mediana de KNN-SVR-TBATS com um resultado de 556.46. O resultado melhor para SMAPE foi de 8,18 novamente usando o combinador mediana, mas com os métodos KNN-SVR-ARIMA.</p>
<div class="cell" data-execution_count="24" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1501_rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="24">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1501_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>KNN SVR THETA</td>
<td>KNN SVR TBATS</td>
<td>KNN SVR THETA TBATS</td>
<td>KNN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>558.642087</td>
<td>556.460089</td>
<td>557.846106</td>
<td>578.924279</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1501_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;16: The Best models for N1501 series for RMSE metric
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="25" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>best_models_smape</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n1501_smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="25">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n1501_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>KNN SVR TBATS</td>
<td>KNN SVR ARIMA</td>
<td>KNN SVR THETA TBATS</td>
<td>KNN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>8.255111</td>
<td>8.181021</td>
<td>8.259065</td>
<td>8.639141</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n1501_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;17: The Best models for N1501 series for SMAPE metric
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="n2401" class="level4 page-columns page-full" data-number="4.2.4">
<h4 data-number="4.2.4" class="anchored" data-anchor-id="n2401"><span class="header-section-number">4.2.4</span> N2401</h4>
<section id="análise-geral-dos-ensembles-da-série-n2401" class="level5 page-columns page-full" data-number="4.2.4.1">
<h5 data-number="4.2.4.1" class="anchored" data-anchor-id="análise-geral-dos-ensembles-da-série-n2401"><span class="header-section-number">4.2.4.1</span> Análise Geral dos <em>Ensembles</em> da Série N2401</h5>
<p>Divisão da séries N2401 em conjuntos de treino e de teste representado em <a href="#fig-n2401-series" class="quarto-xref">Figura&nbsp;9</a></p>
<div id="cell-fig-n2401-series" class="cell fig-cap-location-bottom" data-execution_count="26">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb26" data-cap-location="bottom"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>m1000 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1000'</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m1000.ds[:<span class="op">-</span><span class="dv">18</span>], m1000.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>ax.plot(m1000.ds[<span class="op">-</span><span class="dv">18</span>:], m1000.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-n2401-series" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="bottom">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n2401-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2401-series-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2401-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;9: N2401 MACRO Time Series
</figcaption>
</figure>
</div>
</div>
</div>
<p>Os operadores média aritmética e média ponderada obtiveram resultados médios satisfatórios considerando que esses foram mais acurados que a média dos modelos individuais, tando quando considerada a métrica RMSE quanto SMAPE. A média simples baixou o erro RMSE até 4 métodos no <em>ensemble</em>, mas o valor médio do erro RMSE permaneceu estável aos acrescimos de métodos, ficando de 56,847 para 4 modelos até 56,29 para 9 modelos. Já para o valor médio SMAPE da média simples conseguiu evoluir quando comparada aos modelos individuais, mas de forma mais modesta estabilizando a queda do erro em 7 métodos.</p>
<p>A média ponderada conseguiu minimizar a média do valor de RMSE conforme mais métodos foram adicionados, tendo seu valor médio de RMSE com 9 métodos combinados no valor de 45,27, o que foi um ganho de redução de erro de 26.34%. A média ponderada também obteve desenpenho satisfatório na métrica SMAPE, seu melhor resultado foi 0.86 usando, novamente, 9 modelos em <em>ensemble</em>, tal resultados respresentou uma acrescimento percentual de 24,42%.</p>
<div class="cell" data-execution_count="27" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>rmse_m1000 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1000'</span>,:]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rmse_m1000</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse_mean_n2401" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="27">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse_mean_n2401-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>61.477648</td>
<td>61.477648</td>
<td>61.477648</td>
<td>61.477648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>58.217339</td>
<td>58.217339</td>
<td>54.118063</td>
<td>587.052362</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>57.256398</td>
<td>63.578882</td>
<td>51.954110</td>
<td>606.876608</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>56.847967</td>
<td>62.025995</td>
<td>50.948727</td>
<td>611.767903</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>56.629474</td>
<td>66.172623</td>
<td>49.706190</td>
<td>613.702531</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>56.495061</td>
<td>64.995385</td>
<td>49.470389</td>
<td>615.034361</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>56.404525</td>
<td>70.032623</td>
<td>49.628479</td>
<td>616.250715</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>56.339515</td>
<td>68.962872</td>
<td>47.773117</td>
<td>617.420377</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>56.290603</td>
<td>81.506426</td>
<td>45.278545</td>
<td>618.500663</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse_mean_n2401-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;18: Group of average RMSE value for the N2401 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="28" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>smape_m1000 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1000'</span>,:]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>smape_m1000</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape_mean_n2401" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="28">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape_mean_n2401-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1.138061</td>
<td>1.138061</td>
<td>1.138061</td>
<td>1.138061</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>1.093242</td>
<td>1.093242</td>
<td>1.005505</td>
<td>13.441315</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>1.077536</td>
<td>1.181974</td>
<td>0.972021</td>
<td>13.964399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>1.070418</td>
<td>1.162551</td>
<td>0.956532</td>
<td>14.097096</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>1.067595</td>
<td>1.230142</td>
<td>0.935334</td>
<td>14.148777</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>1.065643</td>
<td>1.219661</td>
<td>0.932302</td>
<td>14.182959</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>1.063856</td>
<td>1.303965</td>
<td>0.936121</td>
<td>14.213464</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>1.063796</td>
<td>1.296970</td>
<td>0.902196</td>
<td>14.242561</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1.063750</td>
<td>1.530510</td>
<td>0.860911</td>
<td>14.269364</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape_mean_n2401-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;19: Group of average SMAPE value for the N2401 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n2401-rmse" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n2401-rmse" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-n2401-rmse-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n2401-rmse-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-n2401-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2401-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n2401-rmse" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-n2401-rmse-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n2401-rmse-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-n2401-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2401-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2401-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;10: Average RMSE values for all combination operators used on N2401 series.
</figcaption>
</figure>
</div>
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n2401-smape" class="quarto-layout-panel page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<div class="quarto-layout-row page-full">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n2401-smape" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-n2401-smape-1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n2401-smape-output-1.png" class="img-fluid figure-img column-page" data-ref-parent="fig-n2401-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2401-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell page-columns page-full" data-ref-parent="fig-n2401-smape" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-n2401-smape-2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-subfloat-fig figure page-columns page-full">
<div aria-describedby="fig-n2401-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="relatorio_files/figure-html/fig-n2401-smape-output-2.png" class="img-fluid figure-img column-page" data-ref-parent="fig-n2401-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2401-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2401-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;11: Average SMAPE values for all combination operators used on N2401 series.
</figcaption>
</figure>
</div>
<p>O operador SVR-Stack mais uma vez não conseguiu performar para esta série, o valor médio melhor de RMSE e de SMAPE foi 587,052 e 13,44, respectivamente e suas pioras percentuais foram: 854,9% RMSE 1081.019% SMAPE. Fora decidido não usar a escala logarítma, pois esta nõ surtiu efeito em adequar a as medidas para que possibilitasse melhor visualização dos gráficos.</p>
<p>O operador mediana não conseguiu resultados superiores ao valor médio das métricas dos modelos individuais, ficando com erros acima desses. Com exceção da mediana de dois métodos, que é a média simples; <em>pari passu</em> ao acresciemento de métodos, o erro adicional crescia.</p>
</section>
<section id="análise-dos-melhores-métodos-da-série-n2401" class="level5" data-number="4.2.4.2">
<h5 data-number="4.2.4.2" class="anchored" data-anchor-id="análise-dos-melhores-métodos-da-série-n2401"><span class="header-section-number">4.2.4.2</span> Análise dos melhores métodos da série N2401</h5>
<p>O melhor modelo para as duas métrica foi o SVR. Seu valor de RMSE foi 24,071 e SMAPE 0,375. O que monstra que, semelhante a série N1411, que modelos individuais podem superar combinação. Para o caso da série M10 o melhor modelos foi o Random Forest, que é uma forma de combinação; o que não é caso do Supporte Vector Regressor.</p>
<div class="cell" data-execution_count="31" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n2401_rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="31">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n2401_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SVR</td>
<td>SVR</td>
<td>SVR</td>
<td>SVR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>24.071385</td>
<td>24.071385</td>
<td>24.071385</td>
<td>24.071385</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n2401_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;20: The Best models for N2401 series for RMSE metric
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="32" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>best_models_smape</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n2401_smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="32">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n2401_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SVR</td>
<td>SVR</td>
<td>SVR</td>
<td>SVR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.375334</td>
<td>0.375334</td>
<td>0.375334</td>
<td>0.375334</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n2401_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;21: The Best models for N2401 series for SMAPE metric
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="n2402" class="level4" data-number="4.2.5">
<h4 data-number="4.2.5" class="anchored" data-anchor-id="n2402"><span class="header-section-number">4.2.5</span> N2402</h4>
<section id="análise-geral-dos-ensembles-da-série-n2402" class="level5" data-number="4.2.5.1">
<h5 data-number="4.2.5.1" class="anchored" data-anchor-id="análise-geral-dos-ensembles-da-série-n2402"><span class="header-section-number">4.2.5.1</span> Análise Geral dos <em>Ensembles</em> da Série N2402</h5>
<p>Divisão em treino e teste da séries MACRO N2402 em <a href="#fig-n2402-series" class="quarto-xref">Figura&nbsp;12</a></p>
<div id="cell-fig-n2402-series" class="cell fig-cap-location-bottom" data-execution_count="33">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb33" data-cap-location="bottom"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>m1001 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1001'</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m1001.ds[:<span class="op">-</span><span class="dv">18</span>], m1001.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>ax.plot(m1001.ds[<span class="op">-</span><span class="dv">18</span>:], m1001.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-n2402-series" class="quarto-float quarto-figure quarto-figure-center anchored" data-cap-location="bottom">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n2402-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2402-series-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2402-series-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;12: N2402 MACRO Time Series
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="34" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>rmse_m1001 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1001'</span>,:]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rmse_m1001</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rmse_mean_n2402" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="34">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-rmse_mean_n2402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>83.407947</td>
<td>83.407947</td>
<td>83.407947</td>
<td>83.407947</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>73.285004</td>
<td>73.285004</td>
<td>75.093525</td>
<td>1085.426539</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>69.580205</td>
<td>72.588443</td>
<td>69.935115</td>
<td>1096.814531</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>67.648698</td>
<td>69.131260</td>
<td>66.785185</td>
<td>1101.889927</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>66.475978</td>
<td>70.630780</td>
<td>65.053965</td>
<td>1106.649339</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>65.693156</td>
<td>68.726045</td>
<td>63.633833</td>
<td>1111.671285</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>65.135420</td>
<td>71.785508</td>
<td>63.073542</td>
<td>1116.819331</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>64.718761</td>
<td>70.210587</td>
<td>62.094675</td>
<td>1124.255680</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>64.396093</td>
<td>77.586133</td>
<td>61.848355</td>
<td>1128.511722</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-rmse_mean_n2402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;22: Group of average RMSE value for the N2402 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="35" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>smape_m1001 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1001'</span>,:]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>smape_m1001</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-smape_mean_n2402" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="35">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-smape_mean_n2402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>0.964031</td>
<td>0.964031</td>
<td>0.964031</td>
<td>0.964031</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>0.876710</td>
<td>0.876710</td>
<td>0.888678</td>
<td>17.568878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>0.848035</td>
<td>0.856360</td>
<td>0.844766</td>
<td>17.785349</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>0.830448</td>
<td>0.819187</td>
<td>0.815630</td>
<td>17.875688</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>0.817112</td>
<td>0.835099</td>
<td>0.795715</td>
<td>17.960136</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>0.807070</td>
<td>0.813104</td>
<td>0.777710</td>
<td>18.049345</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>0.796692</td>
<td>0.854194</td>
<td>0.769880</td>
<td>18.140856</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>0.789211</td>
<td>0.833896</td>
<td>0.753784</td>
<td>18.273115</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>0.778411</td>
<td>0.922534</td>
<td>0.756166</td>
<td>18.348834</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-smape_mean_n2402-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;23: Group of average SMAPE value for the N2402 by number of model on ensemble.
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-nrow="2" data-execution_count="36">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n2402-rmse" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n2402-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-n2402-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n2402-rmse-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n2402-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2402-rmse-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-n2402-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2402-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-n2402-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n2402-rmse-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n2402-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2402-rmse-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-n2402-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2402-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2402-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;13: Average RMSE values for all combination operators used on N2402 series.
</figcaption>
</figure>
</div>
</div>
<p>A série temporal N2402 é monstrado novamente a dificuldade de generalizar do operador SVR-Stack. Mais uma vez obteve os piores resultados com uma piora de 1201.36% em relação à média do valor RMSE do modelos individuais. A piora percentual pela métrica SMAPE é de 1721.57%.</p>
<p>Analisando individualmente 5 séries seguidas de período sasonal 12 e por previsão one-step ahead forecasting, há indicatívos de não adequação da técnica Stack com meta-modelo SVR para prevêr séries com tais características. É preciso ainda mais estudos individuais e geral com esse operador de combinação para ter melhores evidência se tal combinador é vantajoso para previsão nesse contexto.</p>
<p>Os demais combinadores comportaram-se de modo semelhante aos casos anteriores analisados. A média ponderada obtese os melhores resultados, seguida da média simples e da mediana.</p>
<div class="cell" data-layout-nrow="2" data-execution_count="37">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-n2402-smape" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-n2402-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-n2402-smape" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n2402-smape-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n2402-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2402-smape-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-n2402-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2402-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-n2402-smape" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-n2402-smape-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-n2402-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-n2402-smape-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-n2402-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-n2402-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-n2402-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;14: Average SMAPE values for all combination operators used on N2402 series.
</figcaption>
</figure>
</div>
</div>
</section>
<section id="análise-dos-melhores-métodos-da-série-n2402" class="level5" data-number="4.2.5.2">
<h5 data-number="4.2.5.2" class="anchored" data-anchor-id="análise-dos-melhores-métodos-da-série-n2402"><span class="header-section-number">4.2.5.2</span> Análise dos melhores métodos da série N2402</h5>
<div class="cell" data-execution_count="38" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n2402_rmse" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="38">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n2402_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SVR</td>
<td>MLP SVR ARIMA</td>
<td>SVR THETA TBATS</td>
<td>SVR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>45.211441</td>
<td>41.859894</td>
<td>42.612245</td>
<td>45.211441</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n2402_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;24: The Best models for N2402 series for RMSE metric
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-execution_count="39" data-tbl-cap-location="bottom">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>best_models_smape</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-best_model_n2402_smape" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-tbl-cap-location="bottom" data-execution_count="39">
<figure class="quarto-float quarto-float-tbl figure">
<div aria-describedby="tbl-best_model_n2402_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Mean</th>
<th data-quarto-table-cell-role="th">Median</th>
<th data-quarto-table-cell-role="th">FI weigthed AVG</th>
<th data-quarto-table-cell-role="th">Stack SVR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SVR</td>
<td>MLP SVR CES</td>
<td>SVR TBATS</td>
<td>SVR</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.533669</td>
<td>0.480219</td>
<td>0.48439</td>
<td>0.533669</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl" id="tbl-best_model_n2402_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabela&nbsp;25: The Best models for N2402 series for SMAPE metric
</figcaption>
</figure>
</div>
</div>
<p>O modelos modelo para a série M1001 foi a combinação por mediana dos modelos MLP-SVR-ARIMA com o RMSE de 41.85 e mediana de MLP-SVR-CES com resultado de 0.4802.</p>
</section>
</section>
</section>
<section id="agrupamento-do-número-de-modelos-independente-da-série-por-valor-rmse-e-smape" class="level3" data-number="4.3">
<h3 data-number="4.3" class="anchored" data-anchor-id="agrupamento-do-número-de-modelos-independente-da-série-por-valor-rmse-e-smape"><span class="header-section-number">4.3</span> Agrupamento do número de modelos, independente da série, por valor RMSE e SMAPE</h3>
<section id="análise-geral" class="level4" data-number="4.3.1">
<h4 data-number="4.3.1" class="anchored" data-anchor-id="análise-geral"><span class="header-section-number">4.3.1</span> Análise Geral</h4>
<p>Quandos os dados são agrupados para o valor médio do error para a quantidade de modelos combinados (independente das séries histórias), vê-se claramente que média e média ponderada conseguem se sobrepôr aos outros dois combinadores. Stacking, usando meta-modelo o não-linear SVR, piora drasticamente já com dois métodos empilhados quando compara-se aos valores dos modelos individuais e segue até a quantidade 6 de métodos e se estabiliza. Já a mediana tem seu melhor valor com dois métodos no <em>ensemble</em>, o que é a mesma coisa da média aritmética, e ocila piorando levemente.</p>
<div id="9cbb72b6" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>rmse_group <span class="op">=</span> rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].mean()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>rmse_group</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>436.653721</td>
<td>436.653721</td>
<td>436.653721</td>
<td>436.653721</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>413.704050</td>
<td>413.704050</td>
<td>406.919632</td>
<td>812.362506</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>405.591798</td>
<td>429.793309</td>
<td>393.485471</td>
<td>852.604678</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>401.542475</td>
<td>420.327034</td>
<td>385.918979</td>
<td>868.686652</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>399.143370</td>
<td>433.940895</td>
<td>380.714174</td>
<td>874.315697</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>397.564159</td>
<td>427.107355</td>
<td>376.198098</td>
<td>877.221040</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>396.448375</td>
<td>442.518295</td>
<td>372.836348</td>
<td>878.518511</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>395.619142</td>
<td>436.335238</td>
<td>370.041970</td>
<td>879.328168</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>394.979096</td>
<td>472.767420</td>
<td>367.275537</td>
<td>879.685967</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f726112f" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmse_group.<span class="bu">round</span>(<span class="dv">3</span>).to_latex())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>\begin{tabular}{lrrrr}
\toprule
 &amp; rmse_mean &amp; rmse_median &amp; rmse_fi_avg &amp; rmse_stack_svr \\
n_models &amp;  &amp;  &amp;  &amp;  \\
\midrule
1 &amp; 436.654000 &amp; 436.654000 &amp; 436.654000 &amp; 436.654000 \\
2 &amp; 413.704000 &amp; 413.704000 &amp; 406.920000 &amp; 812.363000 \\
3 &amp; 405.592000 &amp; 429.793000 &amp; 393.485000 &amp; 852.605000 \\
4 &amp; 401.542000 &amp; 420.327000 &amp; 385.919000 &amp; 868.687000 \\
5 &amp; 399.143000 &amp; 433.941000 &amp; 380.714000 &amp; 874.316000 \\
6 &amp; 397.564000 &amp; 427.107000 &amp; 376.198000 &amp; 877.221000 \\
7 &amp; 396.448000 &amp; 442.518000 &amp; 372.836000 &amp; 878.519000 \\
8 &amp; 395.619000 &amp; 436.335000 &amp; 370.042000 &amp; 879.328000 \\
9 &amp; 394.979000 &amp; 472.767000 &amp; 367.276000 &amp; 879.686000 \\
\bottomrule
\end{tabular}
</code></pre>
</div>
</div>
<div id="bd12b81b" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>smape_group <span class="op">=</span> smape.groupby([<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].mean()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>smape_group</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>8.577307</td>
<td>8.577307</td>
<td>8.577307</td>
<td>8.577307</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>7.997695</td>
<td>7.997695</td>
<td>7.863253</td>
<td>15.177148</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>7.791640</td>
<td>8.216744</td>
<td>7.535499</td>
<td>16.007417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>7.712112</td>
<td>8.087205</td>
<td>7.380358</td>
<td>16.357504</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>7.677673</td>
<td>8.317236</td>
<td>7.284133</td>
<td>16.494151</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>7.660952</td>
<td>8.230430</td>
<td>7.201888</td>
<td>16.567572</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>7.649093</td>
<td>8.497039</td>
<td>7.141532</td>
<td>16.602857</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>7.643639</td>
<td>8.418477</td>
<td>7.090204</td>
<td>16.624969</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>7.639551</td>
<td>9.022889</td>
<td>7.050703</td>
<td>16.637554</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="79ce9ec6" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(smape_group.<span class="bu">round</span>(<span class="dv">3</span>).to_latex())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>\begin{tabular}{lrrrr}
\toprule
 &amp; smape_mean &amp; smape_median &amp; smape_fi_avg &amp; smape_stack_svr \\
n_models &amp;  &amp;  &amp;  &amp;  \\
\midrule
1 &amp; 8.577000 &amp; 8.577000 &amp; 8.577000 &amp; 8.577000 \\
2 &amp; 7.998000 &amp; 7.998000 &amp; 7.863000 &amp; 15.177000 \\
3 &amp; 7.792000 &amp; 8.217000 &amp; 7.535000 &amp; 16.007000 \\
4 &amp; 7.712000 &amp; 8.087000 &amp; 7.380000 &amp; 16.358000 \\
5 &amp; 7.678000 &amp; 8.317000 &amp; 7.284000 &amp; 16.494000 \\
6 &amp; 7.661000 &amp; 8.230000 &amp; 7.202000 &amp; 16.568000 \\
7 &amp; 7.649000 &amp; 8.497000 &amp; 7.142000 &amp; 16.603000 \\
8 &amp; 7.644000 &amp; 8.418000 &amp; 7.090000 &amp; 16.625000 \\
9 &amp; 7.640000 &amp; 9.023000 &amp; 7.051000 &amp; 16.638000 \\
\bottomrule
\end{tabular}
</code></pre>
</div>
</div>
<div class="cell" data-layout-nrow="2" data-execution_count="44">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-mean-rmse" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mean-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mean-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-mean-rmse-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mean-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-mean-rmse-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-mean-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mean-rmse-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mean-rmse" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-mean-rmse-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mean-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-mean-rmse-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-mean-rmse">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mean-rmse-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mean-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;15: Mean RMSE value for all combination operators by number of models in ensemble
</figcaption>
</figure>
</div>
</div>
<div class="cell" data-layout-nrow="2" data-execution_count="45">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-mean-smape" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mean-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mean-smape" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-mean-smape-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mean-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-mean-smape-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-mean-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mean-smape-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) With SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-mean-smape" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-mean-smape-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-mean-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-mean-smape-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-mean-smape">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-mean-smape-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Without SVR-Stacking
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mean-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;16: Mean SMAPE value for all combination operators by number of models in ensemble
</figcaption>
</figure>
</div>
</div>
</section>
<section id="box-plots" class="level4" data-number="4.3.2">
<h4 data-number="4.3.2" class="anchored" data-anchor-id="box-plots"><span class="header-section-number">4.3.2</span> <em>Box Plots</em></h4>
<div id="cell-fig-boxplot_rmse" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ax.boxplot(rmse_group.loc[<span class="dv">2</span>:,:],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">'SVR-Stacking'</span>])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'RMSE'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplot_rmse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-boxplot_rmse-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot_rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;17: Boxplot for mean RMSE value of all combinators.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-boxplot_smape" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ax.boxplot(smape_group.loc[<span class="dv">2</span>:,:],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">'SVR-Stacking'</span>])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'SMAPE'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplot_smape" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-boxplot_smape-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot_smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;18: Boxplot for mean SMAPE value of all combinators.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-boxplot_rmse_wout_stack" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>ax.boxplot(rmse_group.loc[<span class="dv">2</span>:,[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>]],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>])</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'RMSE'</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplot_rmse_wout_stack" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot_rmse_wout_stack-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-boxplot_rmse_wout_stack-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot_rmse_wout_stack-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;19: Boxplot for mean RMSE value of mean, weigthed mean and median.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-boxplot_smape_wout_stack" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>ax.boxplot(smape_group.loc[<span class="dv">2</span>:,[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>]],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'SMAPE'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplot_smape_wout_stack" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplot_smape_wout_stack-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-boxplot_smape_wout_stack-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot_smape_wout_stack-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;20: Boxplot for mean SMAPE value of mean, weigthed mean and median.
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-boxplots" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">2</span>, layout<span class="op">=</span><span class="st">'constrained'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].boxplot(rmse_group[<span class="st">'rmse_mean'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'RMSE médio da Média'</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].boxplot(rmse_group[<span class="st">'rmse_median'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'RMSE médio da Mediana'</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].boxplot(rmse_group[<span class="st">'rmse_fi_avg'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'RMSE médio da Média Ponderada'</span>)</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].boxplot(rmse_group[<span class="st">'rmse_stack_svr'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'RMSE médio do Stacking'</span>)</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-boxplots" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-boxplots-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;21: Box plot separados para o RMSE médio dos quatro combinadores para todas séries
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="análise-de-dispersão" class="level4" data-number="4.3.3">
<h4 data-number="4.3.3" class="anchored" data-anchor-id="análise-de-dispersão"><span class="header-section-number">4.3.3</span> Análise de Dispersão</h4>
<p>Uma caracteristica importante que se detecta usando os gráficos <a href="#fig-std-rmse" class="quarto-xref">Figura&nbsp;22</a> e <a href="#fig-std-smape" class="quarto-xref">Figura&nbsp;23</a> é que quanto mais modelos são adicionados à combinação, o desvio padrão dos valores médios dos error RMSE e SMAPE caem. Variância e desvio padrão são métricas de dispersão que indicam certa robustês nos dos modelos; usando a analogia do alvo e dos dardos, modelos que baixa variância/desvio padrão tendem a acertar mais num ponto.</p>
<p>Modelos com dispersão menor têm menor incerteza para acerto, o que torna o desvio padrão uma métrica importantíssima para setores como finanças. E ao que os dados indicam que para séries temporais mensais há a tendência de diminuição do desvio padrão ao passo que mais modelos são adicionados.</p>
<div id="87b152dd" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rmse_group_std <span class="op">=</span> rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].std()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>rmse_group_std</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rmse_mean</th>
<th data-quarto-table-cell-role="th">rmse_median</th>
<th data-quarto-table-cell-role="th">rmse_fi_avg</th>
<th data-quarto-table-cell-role="th">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>423.208730</td>
<td>423.208730</td>
<td>423.208730</td>
<td>423.208730</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>376.211326</td>
<td>376.211326</td>
<td>378.640595</td>
<td>416.214809</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>359.513937</td>
<td>389.573959</td>
<td>355.494582</td>
<td>395.833126</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>350.819405</td>
<td>372.831839</td>
<td>345.208761</td>
<td>384.150783</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>345.454508</td>
<td>383.874734</td>
<td>339.261889</td>
<td>379.478790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>341.820900</td>
<td>371.095527</td>
<td>335.090460</td>
<td>378.087280</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>339.256009</td>
<td>380.699867</td>
<td>332.040817</td>
<td>377.647668</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>337.709193</td>
<td>369.024252</td>
<td>330.675614</td>
<td>378.005863</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>341.235354</td>
<td>392.295330</td>
<td>333.140603</td>
<td>383.749293</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-fig-std-rmse" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Média'</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Mediana'</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Média Ponderada'</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para SVR-Stacking'</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos'</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Desvio Padrão RMSE'</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-std-rmse" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-std-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-std-rmse-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-std-rmse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;22: Desvio Padrão do RMSE para os quatro operadores de combinação
</figcaption>
</figure>
</div>
</div>
</div>
<div id="7a12b33e" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>smape_group_std <span class="op">=</span> smape.groupby([<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].std()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>smape_group_std</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">smape_mean</th>
<th data-quarto-table-cell-role="th">smape_median</th>
<th data-quarto-table-cell-role="th">smape_fi_avg</th>
<th data-quarto-table-cell-role="th">smape_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>15.377656</td>
<td>15.377656</td>
<td>15.377656</td>
<td>15.377656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>12.789975</td>
<td>12.789975</td>
<td>13.022529</td>
<td>12.529316</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>12.161019</td>
<td>12.669607</td>
<td>11.872933</td>
<td>12.164527</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>11.937887</td>
<td>12.563457</td>
<td>11.596428</td>
<td>11.956940</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>11.859363</td>
<td>12.677277</td>
<td>11.490803</td>
<td>11.868896</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>11.820234</td>
<td>12.645520</td>
<td>11.424310</td>
<td>11.834602</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>11.801050</td>
<td>12.771200</td>
<td>11.390461</td>
<td>11.820718</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>11.803955</td>
<td>12.768590</td>
<td>11.396934</td>
<td>11.828389</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>11.987759</td>
<td>13.257612</td>
<td>11.581857</td>
<td>12.005059</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-fig-std-smape" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão SMAPE para Média'</span>)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para Mediana'</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para Média Ponderada'</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos'</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Desvio Padrão SMAPE'</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-std-smape" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-std-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-std-smape-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-std-smape-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;23: Desvio Padrão do SMAPE para os quatro operadores de combinação
</figcaption>
</figure>
</div>
</div>
</div>
<div id="eee964e6" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].agg([<span class="st">'mean'</span>,<span class="st">'std'</span>])</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">rmse_mean</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">rmse_median</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">rmse_fi_avg</th>
<th colspan="2" data-quarto-table-cell-role="th" data-halign="left">rmse_stack_svr</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">n_models</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>436.653721</td>
<td>423.208730</td>
<td>436.653721</td>
<td>423.208730</td>
<td>436.653721</td>
<td>423.208730</td>
<td>436.653721</td>
<td>423.208730</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>413.704050</td>
<td>376.211326</td>
<td>413.704050</td>
<td>376.211326</td>
<td>406.919632</td>
<td>378.640595</td>
<td>812.362506</td>
<td>416.214809</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>405.591798</td>
<td>359.513937</td>
<td>429.793309</td>
<td>389.573959</td>
<td>393.485471</td>
<td>355.494582</td>
<td>852.604678</td>
<td>395.833126</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>401.542475</td>
<td>350.819405</td>
<td>420.327034</td>
<td>372.831839</td>
<td>385.918979</td>
<td>345.208761</td>
<td>868.686652</td>
<td>384.150783</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>399.143370</td>
<td>345.454508</td>
<td>433.940895</td>
<td>383.874734</td>
<td>380.714174</td>
<td>339.261889</td>
<td>874.315697</td>
<td>379.478790</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>397.564159</td>
<td>341.820900</td>
<td>427.107355</td>
<td>371.095527</td>
<td>376.198098</td>
<td>335.090460</td>
<td>877.221040</td>
<td>378.087280</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>396.448375</td>
<td>339.256009</td>
<td>442.518295</td>
<td>380.699867</td>
<td>372.836348</td>
<td>332.040817</td>
<td>878.518511</td>
<td>377.647668</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>395.619142</td>
<td>337.709193</td>
<td>436.335238</td>
<td>369.024252</td>
<td>370.041970</td>
<td>330.675614</td>
<td>879.328168</td>
<td>378.005863</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>394.979096</td>
<td>341.235354</td>
<td>472.767420</td>
<td>392.295330</td>
<td>367.275537</td>
<td>333.140603</td>
<td>879.685967</td>
<td>383.749293</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="análise-de-teste-de-hipótese-friedmannemenyi" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="análise-de-teste-de-hipótese-friedmannemenyi"><span class="header-section-number">5</span> Análise de Teste de Hipótese Friedman/Nemenyi</h2>
<p>Após o teste de Friedman — o qual verifica se há diferenças entre os métodos — com significância de 5%, foi possível rejeitar a hipótese nula para ambas métricas, o <em>post hoc</em> de Nemenyi idenficou o nível de diferença entre as populações, baseda na distância crítica CD de 0.303 para a meétrics RMSE e SMAPE, há evidências que corroboboram com a afirmação de que método WAFI é mais acurado que os demais. Os gráficos <a href="#fig-cd" class="quarto-xref">Figura&nbsp;24</a> mostram o <em>ranking</em> dos modelos.</p>
<div id="5bdd5cae" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dc_rmse <span class="op">=</span> pd.DataFrame(mean_rmse_series_models.loc[(<span class="bu">slice</span>(<span class="va">None</span>) , <span class="bu">slice</span>(<span class="dv">2</span>,<span class="dv">9</span>)) , :].values, columns<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">"SVR-Stacking"</span>])</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>rmse_result <span class="op">=</span> autorank(dc_rmse, alpha<span class="op">=</span><span class="fl">0.05</span>, verbose<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span><span class="st">'ascending'</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>dc_smape <span class="op">=</span> pd.DataFrame(mean_smape_series_models.loc[(<span class="bu">slice</span>(<span class="va">None</span>) , <span class="bu">slice</span>(<span class="dv">2</span>,<span class="dv">9</span>)) , :].values, columns<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">"SVR Stacking"</span>])</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>smape_result <span class="op">=</span> autorank(dc_smape, alpha<span class="op">=</span><span class="fl">0.05</span>, verbose<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span><span class="st">'ascending'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="98f12a25" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(create_report(rmse_result))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The statistical analysis was conducted for 4 populations with 240 paired samples.
The family-wise significance level of the tests is alpha=0.050.
We rejected the null hypothesis that the population is normal for the populations Média Ponderada (p=0.000), Média Simples (p=0.000), Mediana (p=0.000), and SVR-Stacking (p=0.000). Therefore, we assume that not all populations are normal.
Because we have more than two populations and the populations and some of them are not normal, we use the non-parametric Friedman test as omnibus test to determine if there are any significant differences between the median values of the populations. We use the post-hoc Nemenyi test to infer which differences are significant. We report the median (MD), the median absolute deviation (MAD) and the mean rank (MR) among all populations over the samples. Differences between populations are significant, if the difference of the mean rank is greater than the critical distance CD=0.303 of the Nemenyi test.
We reject the null hypothesis (p=0.000) of the Friedman test that there is no difference in the central tendency of the populations Média Ponderada (MD=286.990+-112.242, MAD=184.995, MR=1.271), Média Simples (MD=309.483+-109.748, MAD=197.078, MR=2.050), Mediana (MD=330.860+-109.185, MAD=210.527, MR=2.921), and SVR-Stacking (MD=860.793+-78.968, MAD=225.180, MR=3.758). Therefore, we assume that there is a statistically significant difference between the median values of the populations.
Based on the post-hoc Nemenyi test, we assume that all differences between the populations are significant.
None</code></pre>
</div>
</div>
<div id="17ec7d7e" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(create_report(smape_result))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The statistical analysis was conducted for 4 populations with 240 paired samples.
The family-wise significance level of the tests is alpha=0.050.
We rejected the null hypothesis that the population is normal for the populations Média Ponderada (p=0.000), Média Simples (p=0.000), Mediana (p=0.000), and SVR Stacking (p=0.000). Therefore, we assume that not all populations are normal.
Because we have more than two populations and the populations and some of them are not normal, we use the non-parametric Friedman test as omnibus test to determine if there are any significant differences between the median values of the populations. We use the post-hoc Nemenyi test to infer which differences are significant. We report the median (MD), the median absolute deviation (MAD) and the mean rank (MR) among all populations over the samples. Differences between populations are significant, if the difference of the mean rank is greater than the critical distance CD=0.303 of the Nemenyi test.
We reject the null hypothesis (p=0.000) of the Friedman test that there is no difference in the central tendency of the populations Média Ponderada (MD=3.983+-1.339, MAD=2.722, MR=1.238), Média Simples (MD=4.228+-1.399, MAD=3.002, MR=2.096), Mediana (MD=4.744+-2.013, MAD=3.330, MR=2.908), and SVR Stacking (MD=15.524+-1.214, MAD=2.987, MR=3.758). Therefore, we assume that there is a statistically significant difference between the median values of the populations.
Based on the post-hoc Nemenyi test, we assume that all differences between the populations are significant.
None</code></pre>
</div>
</div>
<div class="cell" data-layout-nrow="2" data-execution_count="59">
<details class="code-fold">
<summary>Código</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plot_stats(rmse_result)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>plot_stats(smape_result)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-cd" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cd" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-cd-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-cd-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-cd-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-cd">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-cd-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) CD RSME
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="cell-output cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-cd" style="flex-basis: 100.0%;justify-content: flex-start;">
<div id="fig-cd-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-cd-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="relatorio_files/figure-html/fig-cd-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-cd">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-cd-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) CD SMAPE
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;24: Diagramas de Distância Crítica para as métricas RMSE e SMAPE
</figcaption>
</figure>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Código fonte</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb64" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Análise de Dados dos combinatores Média, Mediana, SVR-Stack e Média Ponderada por *Features Importance*"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> pt</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Rodolfo Viegas de Albuquerque</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations: Universidade de Pernambuco</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: Prof. Dr. João Fausto Lorenzato de Oliveira</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliations: Universidade de Pernambuco</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '04/10/2025'</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">        page-layout: article</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co">        code-fold: true </span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co">        code-tools: true</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="co">  - pseudocode</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>&lt;style&gt;</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>p {</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">text-indent</span><span class="ch">:</span> <span class="dv">30</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">text-align</span><span class="ch">:</span><span class="dv">justify</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>&lt;/style&gt;</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autorank <span class="im">import</span> autorank, create_report, plot_stats</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.m3 <span class="im">import</span> M3</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>Y_df, _, _ <span class="op">=</span> M3.load(directory<span class="op">=</span><span class="st">"./data/monthly"</span>, group<span class="op">=</span><span class="st">"Monthly"</span>)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>unique_ids <span class="op">=</span> Y_df[<span class="st">"unique_id"</span>].unique()[:<span class="dv">30</span>]</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introdução</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>Este relatório é faz a análise prelimilinar dos dados obtidos com o sistema de treino e teste para os quatro combinadores de modelos para tarefas de previsão de séries temporais. O objetivo principal aqui é gerar tabelas e grásficos de agrupapamentos para, então, escrever anotações que serão usadas na escrita do artigo.</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a><span class="fu">##   Primeiro Olhar aos Dados</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>Há três conjuntos de dados pós-execução do sistema: 2 arquivos de resultados de tipo csv paras as métricas RMSE e SMAPE, e 1 com todas as predições dos modelos e suas combinações. Abaixo as cinco primeiras linhas de cada conjunto de dados:</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "All RMSE values for all models and their combination for all time series" </span></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> pd.read_csv(<span class="st">'./monthly_model_sensitivity_rmse_results.csv'</span>)</span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="co">#'/home/rodolfoviegas/projetos/analise_sensibilidade_fi/analise_sensi/data/monthly_model_sensitivity_rmse_results.csv'</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a>rmse.head()</span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape</span></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "All SMAPE values for all models and their combination for all time series" </span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a>smape <span class="op">=</span> pd.read_csv(<span class="st">'./monthly_model_sensitivity_smape_results.csv'</span>)</span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a>smape.head()</span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-observations</span></span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "All observations labeled as train, val, and test for all models and their combination for all time series" </span></span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> pd.read_excel(<span class="st">'./monthly_model_predictions.xlsx'</span>)</span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>preds.head()</span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a>Ao todo foram 30 séries temporais mensais --- período sasonal igual a 12 --- as quais foram usadas na competição de *forecasting* M3. No obstante serem dados bastante conhecidos, usados *benchmarking*, não se sabe seus nomes, mas sim os contextos cujos os dados foram extraídos. São esses: finanças, economia, demografia, indústria e outros.</span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagrama do sistema de treino e teste</span></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a>O sistema e cria combinações para cada operador começando com 2 métodos até 9 reunídos, o algoritmo @alg-comb abaixo descreve o processo:</span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="in">```pseudocode</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: alg-comb</span></span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-indent-size: "1.2em"</span></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-comment-delimiter: "//"</span></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-line-number: true</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-line-number-punc: ":"</span></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a><span class="in">#| html-no-end: false</span></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a><span class="in">#| pdf-placement: "htb!"</span></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a><span class="in">#| pdf-line-number: true</span></span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{algorithm}</span></span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a><span class="in">        \caption{Combinations}</span></span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a><span class="in">        \begin{algorithmic}[1]</span></span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a><span class="in">            \For{$i \gets 1$ to $30$}</span></span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a><span class="in">            \State $ Predictions \gets Training(Statiscal Models, Y_{train}^{i})$  </span></span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a><span class="in">            \State $Predictions \gets Training(ML Models, Y_{train}^{i})$</span></span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a><span class="in">            \For{$j \gets 9$ to $2$}</span></span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a><span class="in">            \State  $Combinations \gets C_j^{9}$  </span></span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a><span class="in">            \State $Operators(Combinations, Predictions)$</span></span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a><span class="in">            \EndFor</span></span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a><span class="in">            \EndFor</span></span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a><span class="in">        \end{algorithmic}</span></span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a><span class="in">    \end{algorithm}</span></span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a>A função *combination* dentro do algoritmo é um combinação para garantir que não haja repetições de *ensembles*, a equação a descreve:</span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a>C_j^{9} = \frac{9!}{j!(9-j)!}</span>
<span id="cb64-121"><a href="#cb64-121" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb64-122"><a href="#cb64-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a><span class="in">%%| label: fig-diagrama</span></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a><span class="in">%%| fig-cap: Diagrama de Treino</span></span>
<span id="cb64-129"><a href="#cb64-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-130"><a href="#cb64-130" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart TD</span></span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a><span class="in">  A((Start)) --&gt; B[(Time Series)]</span></span>
<span id="cb64-132"><a href="#cb64-132" aria-hidden="true" tabindex="-1"></a><span class="in">  B --&gt; C[Training Set]</span></span>
<span id="cb64-133"><a href="#cb64-133" aria-hidden="true" tabindex="-1"></a><span class="in">  B --&gt; D[Test Set]</span></span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a><span class="in">  C --&gt; E[Single Models]</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a><span class="in">  E --&gt; F[Combinations]</span></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a><span class="in">  F --&gt; D</span></span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a><span class="in">  D --&gt; G[Evaluation]</span></span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a><span class="in">  G --&gt; H((End))</span></span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a><span class="fu">## Análise por Agrupamento (Group by)</span></span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agrupamento por série e número de modelos</span></span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a>A @tbl-agg_rmse_mean mostra um agrupamento das séries tratadas e do valor médio de RSME pela quantidade de modelos --- até 9 modelos --- nos *ensembles* para os quatro operadores analidados:</span>
<span id="cb64-145"><a href="#cb64-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-agg_rmse_mean</span></span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of mean RMSE value for all time series e number of model in all ensembles."</span></span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a>mean_rmse_series_models <span class="op">=</span> rmse.groupby([<span class="st">'dataset'</span>,<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].mean()</span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a>mean_rmse_series_models.head(<span class="dv">18</span>)</span>
<span id="cb64-154"><a href="#cb64-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-155"><a href="#cb64-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-156"><a href="#cb64-156" aria-hidden="true" tabindex="-1"></a>Abaixo a @tbl-agg_smape_mean apresenta o agrupamento de séries por valor médio da métrica SMAPE pelo número de modelos combinados para os quatro operadores de combinação:</span>
<span id="cb64-157"><a href="#cb64-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-160"><a href="#cb64-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-161"><a href="#cb64-161" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-agg_smape_mean</span></span>
<span id="cb64-162"><a href="#cb64-162" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of mean SMAPE value for all time series e number of model in all ensembles."</span></span>
<span id="cb64-163"><a href="#cb64-163" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-164"><a href="#cb64-164" aria-hidden="true" tabindex="-1"></a>mean_smape_series_models <span class="op">=</span> smape.groupby([<span class="st">'dataset'</span>,<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].mean()</span>
<span id="cb64-165"><a href="#cb64-165" aria-hidden="true" tabindex="-1"></a>mean_smape_series_models.head(<span class="dv">18</span>)</span>
<span id="cb64-166"><a href="#cb64-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-167"><a href="#cb64-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-168"><a href="#cb64-168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Série N1402, N1411, N1501, N2401 e N2402 &amp;MACRO</span></span>
<span id="cb64-169"><a href="#cb64-169" aria-hidden="true" tabindex="-1"></a>Análise de dados das séries N1402 MICRO, N1411 MICRO, N1501 MICRO, N2401 MACRO e N2402 MACRO</span>
<span id="cb64-170"><a href="#cb64-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-171"><a href="#cb64-171" aria-hidden="true" tabindex="-1"></a><span class="fu">#### N1402</span></span>
<span id="cb64-172"><a href="#cb64-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-173"><a href="#cb64-173" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise Geral dos *Ensembles* da Série N1402</span></span>
<span id="cb64-174"><a href="#cb64-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-175"><a href="#cb64-175" aria-hidden="true" tabindex="-1"></a>Abaixo na figura @fig-n1402-series a série da categoria micro N1402 com 68 observações, sendo que as 18 últimas são para teste. O gráfico a expõe com divisão para treino e teste.</span>
<span id="cb64-176"><a href="#cb64-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-179"><a href="#cb64-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-180"><a href="#cb64-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "N1402 MICRO Time Series"</span></span>
<span id="cb64-181"><a href="#cb64-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap-location: bottom</span></span>
<span id="cb64-182"><a href="#cb64-182" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1402-series</span></span>
<span id="cb64-183"><a href="#cb64-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-184"><a href="#cb64-184" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1'</span>]</span>
<span id="cb64-185"><a href="#cb64-185" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-186"><a href="#cb64-186" aria-hidden="true" tabindex="-1"></a>ax.plot(m1.ds[:<span class="op">-</span><span class="dv">18</span>], m1.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb64-187"><a href="#cb64-187" aria-hidden="true" tabindex="-1"></a>ax.plot(m1.ds[<span class="op">-</span><span class="dv">18</span>:], m1.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb64-188"><a href="#cb64-188" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-189"><a href="#cb64-189" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-190"><a href="#cb64-190" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-191"><a href="#cb64-191" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-192"><a href="#cb64-192" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-193"><a href="#cb64-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-194"><a href="#cb64-194" aria-hidden="true" tabindex="-1"></a>Em relação a série histórica N1402 é claro o fato de que *ensembles* contribuem para maior acurácia, a partir dois modelos combinados os valores de RMSE e de SMAPE começam a cair. O destaque se dá aos combinadores média simples e média ponderada por *features importance* para as duas métricas que são superiores quando comparados à mediana e ao stacking. A média ponderada --- para ambas métrica --- cai mais rápido que os valores da média simples nos primeiros modelos combinados; quando analisada a métrica RMSE há uma aparente convergência de valores a partir de 6 modelos no *ensemble*, quando há estabilização dos resultados para a média ponderada. Já para a métrica SMAPE não há uma convergência aparente, mas uma correlação muito forte entre os valores, os quais pioram tanto para média aritmética quanto média ponderada na combinação de 9 métodos.</span>
<span id="cb64-195"><a href="#cb64-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-198"><a href="#cb64-198" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-199"><a href="#cb64-199" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse_mean_n1402</span></span>
<span id="cb64-200"><a href="#cb64-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average RMSE value for the M1 by number of model on ensemble."</span></span>
<span id="cb64-201"><a href="#cb64-201" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-202"><a href="#cb64-202" aria-hidden="true" tabindex="-1"></a>rmse_m1 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1'</span>,:]</span>
<span id="cb64-203"><a href="#cb64-203" aria-hidden="true" tabindex="-1"></a>rmse_m1</span>
<span id="cb64-204"><a href="#cb64-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-207"><a href="#cb64-207" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-208"><a href="#cb64-208" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape_mean_n1402</span></span>
<span id="cb64-209"><a href="#cb64-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average SMAPE value for the M1 by number of model on ensemble."</span></span>
<span id="cb64-210"><a href="#cb64-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-211"><a href="#cb64-211" aria-hidden="true" tabindex="-1"></a>smape_m1 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1'</span>,:]</span>
<span id="cb64-212"><a href="#cb64-212" aria-hidden="true" tabindex="-1"></a>smape_m1</span>
<span id="cb64-213"><a href="#cb64-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-214"><a href="#cb64-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-215"><a href="#cb64-215" aria-hidden="true" tabindex="-1"></a>Os melhores valores médios de RMSE para média aritmética e média ponderada são 1568,34 e 1563,56 respectivamente e com 9 métodos combinados para ambos. Com respeito à SMAPE os mehores valores médio acontecem quando há 8 modelos combinados para média aritmética, 64.902, e 62.914 para a média ponderada por *features importance* quando a combinação é composta por 7 modelos.</span>
<span id="cb64-216"><a href="#cb64-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-217"><a href="#cb64-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-218"><a href="#cb64-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-221"><a href="#cb64-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-222"><a href="#cb64-222" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1402</span></span>
<span id="cb64-223"><a href="#cb64-223" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average RMSE and SMAPE values for all combination operators used on N1402 series."</span></span>
<span id="cb64-224"><a href="#cb64-224" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb64-225"><a href="#cb64-225" aria-hidden="true" tabindex="-1"></a><span class="co">#|      - "RMSE"</span></span>
<span id="cb64-226"><a href="#cb64-226" aria-hidden="true" tabindex="-1"></a><span class="co">#|      - "SMAPE"</span></span>
<span id="cb64-227"><a href="#cb64-227" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-228"><a href="#cb64-228" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>)</span>
<span id="cb64-229"><a href="#cb64-229" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-230"><a href="#cb64-230" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-231"><a href="#cb64-231" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1.index, rmse_m1[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-232"><a href="#cb64-232" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-233"><a href="#cb64-233" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-234"><a href="#cb64-234" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-235"><a href="#cb64-235" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-236"><a href="#cb64-236" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-237"><a href="#cb64-237" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-238"><a href="#cb64-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-239"><a href="#cb64-239" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-240"><a href="#cb64-240" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-241"><a href="#cb64-241" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-242"><a href="#cb64-242" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-243"><a href="#cb64-243" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m1.index, smape_m1[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-244"><a href="#cb64-244" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb64-245"><a href="#cb64-245" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-246"><a href="#cb64-246" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-247"><a href="#cb64-247" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-248"><a href="#cb64-248" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb64-249"><a href="#cb64-249" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-250"><a href="#cb64-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-251"><a href="#cb64-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-252"><a href="#cb64-252" aria-hidden="true" tabindex="-1"></a>A mediana, que geralmente tem resultados melhores que a média simples, por ser mais robusta a distribuições assimétricas e *outliers* não foi tão bem, tendo seu melhor resultado com 4 modelos para a métrica RSME ficando com 1739.003, e piorando ao passo que o número de elementos aumenta. O valor médio da métrica SMAPE mais acurádo é 69.031 novamente para combinação de 4 modelos.</span>
<span id="cb64-253"><a href="#cb64-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-254"><a href="#cb64-254" aria-hidden="true" tabindex="-1"></a>Já a técnica de stacking por SVR melhorou a acurácia quando comparada aos modelos individuais, mas parou de evoluir a partir de 6 métodos na combinação.</span>
<span id="cb64-255"><a href="#cb64-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-256"><a href="#cb64-256" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise dos melhores métodos da série N1402</span></span>
<span id="cb64-257"><a href="#cb64-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-258"><a href="#cb64-258" aria-hidden="true" tabindex="-1"></a>Quando analisadas individuamente, a melhor combinação para para a série M1 é o STACKING de SVR. O valor de RMSE @tbl-best_model_n1402_rmse dessa é 1293,006 e 1438,399 para a média ponderada por *features importance*, a segunda melhor. Usando o cálculo de *percentual improvement* $Percentual Improvement = \frac{Error1 - Error2}{Error1} * 100$, temos que há uma melhoria de -10.108%. Já para a métrica SMAPE @tbl-best_model_n1402_smape, o valor para Stack é 50,78 e 53,248 para média aritmética, houve uma melhoria percentual de acurácia de -4,621%.</span>
<span id="cb64-259"><a href="#cb64-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-262"><a href="#cb64-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-263"><a href="#cb64-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1402_rmse</span></span>
<span id="cb64-264"><a href="#cb64-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for M1 series for RMSE metric'</span></span>
<span id="cb64-265"><a href="#cb64-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-266"><a href="#cb64-266" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-267"><a href="#cb64-267" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-268"><a href="#cb64-268" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-269"><a href="#cb64-269" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-270"><a href="#cb64-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-271"><a href="#cb64-271" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-272"><a href="#cb64-272" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-273"><a href="#cb64-273" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-274"><a href="#cb64-274" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-275"><a href="#cb64-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-276"><a href="#cb64-276" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-277"><a href="#cb64-277" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span>
<span id="cb64-278"><a href="#cb64-278" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-279"><a href="#cb64-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-280"><a href="#cb64-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-283"><a href="#cb64-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-284"><a href="#cb64-284" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1402_smape</span></span>
<span id="cb64-285"><a href="#cb64-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N1402 series for SMAPE metric'</span></span>
<span id="cb64-286"><a href="#cb64-286" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-287"><a href="#cb64-287" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-288"><a href="#cb64-288" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-289"><a href="#cb64-289" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-290"><a href="#cb64-290" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-291"><a href="#cb64-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-292"><a href="#cb64-292" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-293"><a href="#cb64-293" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-294"><a href="#cb64-294" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-295"><a href="#cb64-295" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-296"><a href="#cb64-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-297"><a href="#cb64-297" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-298"><a href="#cb64-298" aria-hidden="true" tabindex="-1"></a>best_models_smape</span>
<span id="cb64-299"><a href="#cb64-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-300"><a href="#cb64-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-301"><a href="#cb64-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-302"><a href="#cb64-302" aria-hidden="true" tabindex="-1"></a><span class="fu">#### N1411</span></span>
<span id="cb64-303"><a href="#cb64-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-304"><a href="#cb64-304" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise Geral dos *Ensembles* da Série N1411</span></span>
<span id="cb64-305"><a href="#cb64-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-306"><a href="#cb64-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-307"><a href="#cb64-307" aria-hidden="true" tabindex="-1"></a>Na figura @fig-n1411-series a série MICRO N1411 dividida em dois conjuntos de treino e de teste.</span>
<span id="cb64-308"><a href="#cb64-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-311"><a href="#cb64-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-312"><a href="#cb64-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "N1411 MICRO Time Series"</span></span>
<span id="cb64-313"><a href="#cb64-313" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap-location: bottom</span></span>
<span id="cb64-314"><a href="#cb64-314" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1411-series</span></span>
<span id="cb64-315"><a href="#cb64-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-316"><a href="#cb64-316" aria-hidden="true" tabindex="-1"></a>m10 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M10'</span>]</span>
<span id="cb64-317"><a href="#cb64-317" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-318"><a href="#cb64-318" aria-hidden="true" tabindex="-1"></a>ax.plot(m10.ds[:<span class="op">-</span><span class="dv">18</span>], m10.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb64-319"><a href="#cb64-319" aria-hidden="true" tabindex="-1"></a>ax.plot(m10.ds[<span class="op">-</span><span class="dv">18</span>:], m10.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb64-320"><a href="#cb64-320" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-321"><a href="#cb64-321" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-322"><a href="#cb64-322" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-323"><a href="#cb64-323" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-324"><a href="#cb64-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-325"><a href="#cb64-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-326"><a href="#cb64-326" aria-hidden="true" tabindex="-1"></a>Na série N1411, as combinações obtiveram resultados bons quando considerada a métrica RMSE (@tbl-rmse_mean_n1411). Semelhante à série N1402, as combinações de média ponderada e média aritmética tiveram, em média, os melhores resultados. A média dos erros mais baixa para média simple é de 758,201 e se deu com 9 modelos combinados; já para a média ponderada, o valor médio do erro mais baixo foi 743,206 e ocorreu com 8 métodos combinados. O operador mediana foi mais acurado que svr-stacking, este manteve-se estável em performance a partir de 3 modelos, ou seja, sem melhorias ou pioras. Já mediana ocilou bastante crescendo e diminuindo o error ao passo que mais modelos foram acrescentados.</span>
<span id="cb64-327"><a href="#cb64-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-330"><a href="#cb64-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-331"><a href="#cb64-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse_mean_n1411</span></span>
<span id="cb64-332"><a href="#cb64-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average RMSE value for the N1411 by number of model on ensemble."</span></span>
<span id="cb64-333"><a href="#cb64-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-334"><a href="#cb64-334" aria-hidden="true" tabindex="-1"></a>rmse_m10 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M10'</span>,:]</span>
<span id="cb64-335"><a href="#cb64-335" aria-hidden="true" tabindex="-1"></a>rmse_m10</span>
<span id="cb64-336"><a href="#cb64-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-337"><a href="#cb64-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-338"><a href="#cb64-338" aria-hidden="true" tabindex="-1"></a>Em relação a métrica SMAPE @tbl-smape_mean_n1411, o resultado foi muito semelhante à merica RMSE. Média aritmética e média ponderada obtiveram melhores resultados quanto mais modelos são acrescentados à combinação. A média ponderada for *features importances* conseguiu o melhor resultados médio com 8 métodos obtendo 14,35 de SMAPE médio, mas e voltou a crescer quando um modelo é adicionado. </span>
<span id="cb64-339"><a href="#cb64-339" aria-hidden="true" tabindex="-1"></a>A média simples descresce o erro SMAPE médio quanto mais modelos são acrescentados, tendo seu erro médio mais baixo com  nove métodos combinados. Os valores médios de SMAPE para svr-stacking também permaneceram estáveis ao número de 3 métodos e a mediana novamente com muita ocialação, mas conseguindo escore mais acurado quando comparada ao svr-stacking.</span>
<span id="cb64-340"><a href="#cb64-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-343"><a href="#cb64-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-344"><a href="#cb64-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape_mean_n1411</span></span>
<span id="cb64-345"><a href="#cb64-345" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average SMAPE value for the N1411 by number of model on ensemble."</span></span>
<span id="cb64-346"><a href="#cb64-346" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-347"><a href="#cb64-347" aria-hidden="true" tabindex="-1"></a>smape_m10 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M10'</span>,:]</span>
<span id="cb64-348"><a href="#cb64-348" aria-hidden="true" tabindex="-1"></a>smape_m10</span>
<span id="cb64-349"><a href="#cb64-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-350"><a href="#cb64-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-353"><a href="#cb64-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-354"><a href="#cb64-354" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1411</span></span>
<span id="cb64-355"><a href="#cb64-355" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average RMSE and SMAPE values for all combination operators used on N1411 series."</span></span>
<span id="cb64-356"><a href="#cb64-356" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb64-357"><a href="#cb64-357" aria-hidden="true" tabindex="-1"></a><span class="co">#|      - "RMSE"</span></span>
<span id="cb64-358"><a href="#cb64-358" aria-hidden="true" tabindex="-1"></a><span class="co">#|      - "SMAPE"</span></span>
<span id="cb64-359"><a href="#cb64-359" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-360"><a href="#cb64-360" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-361"><a href="#cb64-361" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-362"><a href="#cb64-362" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-363"><a href="#cb64-363" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m10.index, rmse_m10[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-364"><a href="#cb64-364" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-365"><a href="#cb64-365" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-366"><a href="#cb64-366" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-367"><a href="#cb64-367" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-368"><a href="#cb64-368" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-369"><a href="#cb64-369" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-370"><a href="#cb64-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-371"><a href="#cb64-371" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-372"><a href="#cb64-372" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-373"><a href="#cb64-373" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-374"><a href="#cb64-374" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-375"><a href="#cb64-375" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m10.index, smape_m10[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-376"><a href="#cb64-376" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb64-377"><a href="#cb64-377" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-378"><a href="#cb64-378" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-379"><a href="#cb64-379" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-380"><a href="#cb64-380" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb64-381"><a href="#cb64-381" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-382"><a href="#cb64-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-383"><a href="#cb64-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-384"><a href="#cb64-384" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise dos melhores métodos da série N1411</span></span>
<span id="cb64-385"><a href="#cb64-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-386"><a href="#cb64-386" aria-hidden="true" tabindex="-1"></a>O melhor modelos dentre todos os individuais e todas as combinações foi o Random Forest, a exceção do combinador média ponderada por *features importance* na métrica RMSE, em todos os outros cenários quando comparado aos outras combinações o Random Forest sai-se melhor, tanto quando avalidado por RMSE quanto por SMAPE. É-se preciso destacar que tal modelos é um ensemble, porém uma forma homogência, *i.e.*, são várias árvores de decisão que o compõem.</span>
<span id="cb64-387"><a href="#cb64-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-390"><a href="#cb64-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-391"><a href="#cb64-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1411_rmse</span></span>
<span id="cb64-392"><a href="#cb64-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N1411 series for RMSE metric'</span></span>
<span id="cb64-393"><a href="#cb64-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-394"><a href="#cb64-394" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-395"><a href="#cb64-395" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-396"><a href="#cb64-396" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-397"><a href="#cb64-397" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-398"><a href="#cb64-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-399"><a href="#cb64-399" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-400"><a href="#cb64-400" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-401"><a href="#cb64-401" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-402"><a href="#cb64-402" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-403"><a href="#cb64-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-404"><a href="#cb64-404" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-405"><a href="#cb64-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-406"><a href="#cb64-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-409"><a href="#cb64-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-410"><a href="#cb64-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1411_smape</span></span>
<span id="cb64-411"><a href="#cb64-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for M10 series for SMAPE metric'</span></span>
<span id="cb64-412"><a href="#cb64-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-413"><a href="#cb64-413" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-414"><a href="#cb64-414" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-415"><a href="#cb64-415" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-416"><a href="#cb64-416" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M10'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-417"><a href="#cb64-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-418"><a href="#cb64-418" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-419"><a href="#cb64-419" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-420"><a href="#cb64-420" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-421"><a href="#cb64-421" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-422"><a href="#cb64-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-423"><a href="#cb64-423" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-424"><a href="#cb64-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-425"><a href="#cb64-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-426"><a href="#cb64-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-427"><a href="#cb64-427" aria-hidden="true" tabindex="-1"></a><span class="fu">#### N1501</span></span>
<span id="cb64-428"><a href="#cb64-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-429"><a href="#cb64-429" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise Geral dos *Ensembles* da Série N1501</span></span>
<span id="cb64-430"><a href="#cb64-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-431"><a href="#cb64-431" aria-hidden="true" tabindex="-1"></a>A figura @fig-n1501-series mostra a série MICRO N1501 dividas em treino e teste</span>
<span id="cb64-432"><a href="#cb64-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-435"><a href="#cb64-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-436"><a href="#cb64-436" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "N1501 MICRO Time Series"</span></span>
<span id="cb64-437"><a href="#cb64-437" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap-location: bottom</span></span>
<span id="cb64-438"><a href="#cb64-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1501-series</span></span>
<span id="cb64-439"><a href="#cb64-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-440"><a href="#cb64-440" aria-hidden="true" tabindex="-1"></a>m100 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M100'</span>]</span>
<span id="cb64-441"><a href="#cb64-441" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-442"><a href="#cb64-442" aria-hidden="true" tabindex="-1"></a>ax.plot(m100.ds[:<span class="op">-</span><span class="dv">18</span>], m100.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb64-443"><a href="#cb64-443" aria-hidden="true" tabindex="-1"></a>ax.plot(m100.ds[<span class="op">-</span><span class="dv">18</span>:], m100.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb64-444"><a href="#cb64-444" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-445"><a href="#cb64-445" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-446"><a href="#cb64-446" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-447"><a href="#cb64-447" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-448"><a href="#cb64-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-449"><a href="#cb64-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-450"><a href="#cb64-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-451"><a href="#cb64-451" aria-hidden="true" tabindex="-1"></a>Para ambas as métricas @tbl-rmse_mean_n1501 e @tbl-smape_mean_n1501, o destaque se deu ao mal desepenho do operador SVR-Stack. Em média, o valor RMSE e SMAPE piorou drasticamente já na primeira combinação com dois métodos indicando um possível *overfitting*; a partir de três métodos há uma estabilidade de do erro. A média dos valores RMSE dos modelos individuais é 619.75, já o valor RMSE médio do SVR-Stack com dois modelos usados é 1415.82, houve uma piora de 56.226%. Para para SMAPE, o valor médio modelos individuais é 9.52 e do SVR-Stack com dois métodos de 21.9, a piora foi de 56.53%. </span>
<span id="cb64-452"><a href="#cb64-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-453"><a href="#cb64-453" aria-hidden="true" tabindex="-1"></a>Os graficos @fig-n1501-rmse e @fig-n1501-rmse ilustram a piora no operator. Para ambas métricas os gráficos são utilizados em escala logarítmica, no entato, dada a magnitude da média dos valores de error, ainda assim não é possível haver uma visualização clara das tendência. Sendo, então, necessária a retirada da projeção de erros do operador SVR-Stacking com o intuitito de exibir as curvas de média de erros dos demais operadores.</span>
<span id="cb64-454"><a href="#cb64-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-457"><a href="#cb64-457" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-458"><a href="#cb64-458" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse_mean_n1501</span></span>
<span id="cb64-459"><a href="#cb64-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average RMSE value for the N1501 by number of model on ensemble."</span></span>
<span id="cb64-460"><a href="#cb64-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-461"><a href="#cb64-461" aria-hidden="true" tabindex="-1"></a>rmse_m100 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M100'</span>,:]</span>
<span id="cb64-462"><a href="#cb64-462" aria-hidden="true" tabindex="-1"></a>rmse_m100</span>
<span id="cb64-463"><a href="#cb64-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-464"><a href="#cb64-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-465"><a href="#cb64-465" aria-hidden="true" tabindex="-1"></a>Semelhante às outras séries, os resultados de média simples e média ponderada foram os mais acurádos, e quanto mais modelos são acrescentados, o valor do RMSE e SMAPE --- em média --- cai. A média ponderada por *features importances* ficando com o valor de 594.568 para a métrica RMSE  e 9,116 para SMAPE. </span>
<span id="cb64-466"><a href="#cb64-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-467"><a href="#cb64-467" aria-hidden="true" tabindex="-1"></a>Com relação à média simples, houve melhora contínua ao passo que mais modelos são acrescendados. Nota-se também que há uma lacuna acentuada entre as curvas, diferentemente das séries analisadas, indicando que a média ponderada conseguiu atriuir pesos significados aos métodos e consequentemente mais poder preditivo aos *ensembles*. </span>
<span id="cb64-468"><a href="#cb64-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-471"><a href="#cb64-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-472"><a href="#cb64-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape_mean_n1501</span></span>
<span id="cb64-473"><a href="#cb64-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average SMAPE value for the N1501 by number of model on ensemble."</span></span>
<span id="cb64-474"><a href="#cb64-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-475"><a href="#cb64-475" aria-hidden="true" tabindex="-1"></a>smape_m100 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M100'</span>,:]</span>
<span id="cb64-476"><a href="#cb64-476" aria-hidden="true" tabindex="-1"></a>smape_m100</span>
<span id="cb64-477"><a href="#cb64-477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-478"><a href="#cb64-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-479"><a href="#cb64-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-482"><a href="#cb64-482" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-483"><a href="#cb64-483" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1501-rmse</span></span>
<span id="cb64-484"><a href="#cb64-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average RMSE values for all combination operators used on N1501 series."</span></span>
<span id="cb64-485"><a href="#cb64-485" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-486"><a href="#cb64-486" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-487"><a href="#cb64-487" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-488"><a href="#cb64-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb64-489"><a href="#cb64-489" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-490"><a href="#cb64-490" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb64-491"><a href="#cb64-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-492"><a href="#cb64-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-493"><a href="#cb64-493" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-494"><a href="#cb64-494" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>)</span>
<span id="cb64-495"><a href="#cb64-495" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-496"><a href="#cb64-496" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-497"><a href="#cb64-497" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-498"><a href="#cb64-498" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-499"><a href="#cb64-499" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-500"><a href="#cb64-500" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-501"><a href="#cb64-501" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-502"><a href="#cb64-502" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-503"><a href="#cb64-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-504"><a href="#cb64-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-505"><a href="#cb64-505" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-506"><a href="#cb64-506" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média'</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb64-507"><a href="#cb64-507" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb64-508"><a href="#cb64-508" aria-hidden="true" tabindex="-1"></a>ax2.plot(rmse_m100.index, rmse_m100[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb64-509"><a href="#cb64-509" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb64-510"><a href="#cb64-510" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-511"><a href="#cb64-511" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-512"><a href="#cb64-512" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-513"><a href="#cb64-513" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb64-514"><a href="#cb64-514" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-515"><a href="#cb64-515" aria-hidden="true" tabindex="-1"></a><span class="co">#ax[1].set_title("Without SVR-Stacking")</span></span>
<span id="cb64-516"><a href="#cb64-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-517"><a href="#cb64-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-518"><a href="#cb64-518" aria-hidden="true" tabindex="-1"></a>O operador mediana conseguiu resultados mais acuradas em ambas métricas quando comparados aos modelos individuais, houve ocilação ao passo que mais métodos são adicionados, mas com a clara tendência de queda, com os melhores valores médios para RMSE e SMAPE com *ensemble* de 8 modelos: RMSE igual a 596,75 e SMAPE igual a 9,20.</span>
<span id="cb64-519"><a href="#cb64-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-522"><a href="#cb64-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-523"><a href="#cb64-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n1501-smape</span></span>
<span id="cb64-524"><a href="#cb64-524" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average SMAPE values for all combination operators used on M100 series."</span></span>
<span id="cb64-525"><a href="#cb64-525" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-526"><a href="#cb64-526" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-527"><a href="#cb64-527" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking (Log Scale)"</span></span>
<span id="cb64-528"><a href="#cb64-528" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-529"><a href="#cb64-529" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb64-530"><a href="#cb64-530" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrows: 2</span></span>
<span id="cb64-531"><a href="#cb64-531" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-align: center</span></span>
<span id="cb64-532"><a href="#cb64-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-533"><a href="#cb64-533" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-534"><a href="#cb64-534" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>,color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb64-535"><a href="#cb64-535" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb64-536"><a href="#cb64-536" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb64-537"><a href="#cb64-537" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m100.index, smape_m100[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>, color<span class="op">=</span><span class="st">'mediumvioletred'</span>)</span>
<span id="cb64-538"><a href="#cb64-538" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-539"><a href="#cb64-539" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-540"><a href="#cb64-540" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-541"><a href="#cb64-541" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-542"><a href="#cb64-542" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-543"><a href="#cb64-543" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-544"><a href="#cb64-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-545"><a href="#cb64-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-546"><a href="#cb64-546" aria-hidden="true" tabindex="-1"></a><span class="co"># sem stack</span></span>
<span id="cb64-547"><a href="#cb64-547" aria-hidden="true" tabindex="-1"></a>fig2, ax2 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-548"><a href="#cb64-548" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb64-549"><a href="#cb64-549" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>, color<span class="op">=</span><span class="st">'lightcoral'</span>)</span>
<span id="cb64-550"><a href="#cb64-550" aria-hidden="true" tabindex="-1"></a>ax2.plot(smape_m100.index, smape_m100[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>, color<span class="op">=</span><span class="st">'yellowgreen'</span>)</span>
<span id="cb64-551"><a href="#cb64-551" aria-hidden="true" tabindex="-1"></a>ax2.grid()</span>
<span id="cb64-552"><a href="#cb64-552" aria-hidden="true" tabindex="-1"></a>ax2.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-553"><a href="#cb64-553" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-554"><a href="#cb64-554" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-555"><a href="#cb64-555" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb64-556"><a href="#cb64-556" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-557"><a href="#cb64-557" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-558"><a href="#cb64-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-559"><a href="#cb64-559" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise dos melhores métodos da série N1501</span></span>
<span id="cb64-560"><a href="#cb64-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-561"><a href="#cb64-561" aria-hidden="true" tabindex="-1"></a>Em relação aos melhores métodos para a série N1501, para a métrica RMSE o melhor *ensemble* foi a mediana de KNN-SVR-TBATS com um resultado de 556.46. O resultado melhor para SMAPE foi de 8,18 novamente usando o combinador mediana, mas com os métodos KNN-SVR-ARIMA.</span>
<span id="cb64-562"><a href="#cb64-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-565"><a href="#cb64-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-566"><a href="#cb64-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1501_rmse</span></span>
<span id="cb64-567"><a href="#cb64-567" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N1501 series for RMSE metric'</span></span>
<span id="cb64-568"><a href="#cb64-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-569"><a href="#cb64-569" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-570"><a href="#cb64-570" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-571"><a href="#cb64-571" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-572"><a href="#cb64-572" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-573"><a href="#cb64-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-574"><a href="#cb64-574" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-575"><a href="#cb64-575" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-576"><a href="#cb64-576" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-577"><a href="#cb64-577" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-578"><a href="#cb64-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-579"><a href="#cb64-579" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-580"><a href="#cb64-580" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span>
<span id="cb64-581"><a href="#cb64-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-582"><a href="#cb64-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-583"><a href="#cb64-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-586"><a href="#cb64-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-587"><a href="#cb64-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n1501_smape</span></span>
<span id="cb64-588"><a href="#cb64-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N1501 series for SMAPE metric'</span></span>
<span id="cb64-589"><a href="#cb64-589" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-590"><a href="#cb64-590" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-591"><a href="#cb64-591" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-592"><a href="#cb64-592" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-593"><a href="#cb64-593" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M100'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-594"><a href="#cb64-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-595"><a href="#cb64-595" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-596"><a href="#cb64-596" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-597"><a href="#cb64-597" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-598"><a href="#cb64-598" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-599"><a href="#cb64-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-600"><a href="#cb64-600" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-601"><a href="#cb64-601" aria-hidden="true" tabindex="-1"></a>best_models_smape</span>
<span id="cb64-602"><a href="#cb64-602" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-603"><a href="#cb64-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-604"><a href="#cb64-604" aria-hidden="true" tabindex="-1"></a><span class="fu">#### N2401</span></span>
<span id="cb64-605"><a href="#cb64-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-606"><a href="#cb64-606" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise Geral dos *Ensembles* da Série N2401</span></span>
<span id="cb64-607"><a href="#cb64-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-608"><a href="#cb64-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-609"><a href="#cb64-609" aria-hidden="true" tabindex="-1"></a>Divisão da séries N2401 em conjuntos de treino e de teste representado em @fig-n2401-series</span>
<span id="cb64-610"><a href="#cb64-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-613"><a href="#cb64-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-614"><a href="#cb64-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "N2401 MACRO Time Series"</span></span>
<span id="cb64-615"><a href="#cb64-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap-location: bottom</span></span>
<span id="cb64-616"><a href="#cb64-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2401-series</span></span>
<span id="cb64-617"><a href="#cb64-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-618"><a href="#cb64-618" aria-hidden="true" tabindex="-1"></a>m1000 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1000'</span>]</span>
<span id="cb64-619"><a href="#cb64-619" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-620"><a href="#cb64-620" aria-hidden="true" tabindex="-1"></a>ax.plot(m1000.ds[:<span class="op">-</span><span class="dv">18</span>], m1000.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb64-621"><a href="#cb64-621" aria-hidden="true" tabindex="-1"></a>ax.plot(m1000.ds[<span class="op">-</span><span class="dv">18</span>:], m1000.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb64-622"><a href="#cb64-622" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-623"><a href="#cb64-623" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-624"><a href="#cb64-624" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-625"><a href="#cb64-625" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-626"><a href="#cb64-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-627"><a href="#cb64-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-628"><a href="#cb64-628" aria-hidden="true" tabindex="-1"></a>Os operadores média aritmética e média ponderada obtiveram resultados médios satisfatórios considerando que esses foram mais acurados que a média dos modelos individuais, tando quando considerada a métrica RMSE quanto SMAPE. A média simples baixou o erro RMSE até 4 métodos no *ensemble*, mas o valor médio do erro RMSE permaneceu estável aos acrescimos de métodos, ficando de 56,847 para 4 modelos até 56,29 para 9 modelos. Já para o valor médio SMAPE da média simples conseguiu evoluir quando comparada aos modelos individuais, mas de forma mais modesta estabilizando a queda do erro em 7 métodos. </span>
<span id="cb64-629"><a href="#cb64-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-630"><a href="#cb64-630" aria-hidden="true" tabindex="-1"></a>A média ponderada conseguiu minimizar a média do valor de RMSE conforme mais métodos foram adicionados, tendo seu valor médio de RMSE com 9 métodos combinados no valor de 45,27, o que foi um ganho de redução de erro de 26.34%. A média ponderada também obteve desenpenho satisfatório na métrica SMAPE, seu melhor resultado foi 0.86 usando, novamente, 9 modelos em *ensemble*, tal resultados respresentou uma acrescimento percentual de 24,42%.</span>
<span id="cb64-631"><a href="#cb64-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-634"><a href="#cb64-634" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-635"><a href="#cb64-635" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse_mean_n2401</span></span>
<span id="cb64-636"><a href="#cb64-636" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average RMSE value for the N2401 by number of model on ensemble."</span></span>
<span id="cb64-637"><a href="#cb64-637" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-638"><a href="#cb64-638" aria-hidden="true" tabindex="-1"></a>rmse_m1000 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1000'</span>,:]</span>
<span id="cb64-639"><a href="#cb64-639" aria-hidden="true" tabindex="-1"></a>rmse_m1000</span>
<span id="cb64-640"><a href="#cb64-640" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-641"><a href="#cb64-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-644"><a href="#cb64-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-645"><a href="#cb64-645" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape_mean_n2401</span></span>
<span id="cb64-646"><a href="#cb64-646" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average SMAPE value for the N2401 by number of model on ensemble."</span></span>
<span id="cb64-647"><a href="#cb64-647" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-648"><a href="#cb64-648" aria-hidden="true" tabindex="-1"></a>smape_m1000 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1000'</span>,:]</span>
<span id="cb64-649"><a href="#cb64-649" aria-hidden="true" tabindex="-1"></a>smape_m1000</span>
<span id="cb64-650"><a href="#cb64-650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-651"><a href="#cb64-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-654"><a href="#cb64-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-655"><a href="#cb64-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2401-rmse</span></span>
<span id="cb64-656"><a href="#cb64-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average RMSE values for all combination operators used on N2401 series."</span></span>
<span id="cb64-657"><a href="#cb64-657" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-658"><a href="#cb64-658" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-659"><a href="#cb64-659" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-660"><a href="#cb64-660" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb64-661"><a href="#cb64-661" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb64-662"><a href="#cb64-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-663"><a href="#cb64-663" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-664"><a href="#cb64-664" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-665"><a href="#cb64-665" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-666"><a href="#cb64-666" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-667"><a href="#cb64-667" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-668"><a href="#cb64-668" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-669"><a href="#cb64-669" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-670"><a href="#cb64-670" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-671"><a href="#cb64-671" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-672"><a href="#cb64-672" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-673"><a href="#cb64-673" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-674"><a href="#cb64-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-675"><a href="#cb64-675" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-676"><a href="#cb64-676" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-677"><a href="#cb64-677" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-678"><a href="#cb64-678" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1000.index, rmse_m1000[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-679"><a href="#cb64-679" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-680"><a href="#cb64-680" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-681"><a href="#cb64-681" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-682"><a href="#cb64-682" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-683"><a href="#cb64-683" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-684"><a href="#cb64-684" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-685"><a href="#cb64-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-686"><a href="#cb64-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-687"><a href="#cb64-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-690"><a href="#cb64-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-691"><a href="#cb64-691" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2401-smape</span></span>
<span id="cb64-692"><a href="#cb64-692" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average SMAPE values for all combination operators used on N2401 series."</span></span>
<span id="cb64-693"><a href="#cb64-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-694"><a href="#cb64-694" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-695"><a href="#cb64-695" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-696"><a href="#cb64-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb64-697"><a href="#cb64-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page</span></span>
<span id="cb64-698"><a href="#cb64-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-699"><a href="#cb64-699" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-700"><a href="#cb64-700" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-701"><a href="#cb64-701" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-702"><a href="#cb64-702" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-703"><a href="#cb64-703" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-704"><a href="#cb64-704" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-705"><a href="#cb64-705" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-706"><a href="#cb64-706" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-707"><a href="#cb64-707" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-708"><a href="#cb64-708" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-709"><a href="#cb64-709" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-710"><a href="#cb64-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-711"><a href="#cb64-711" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-712"><a href="#cb64-712" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-713"><a href="#cb64-713" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-714"><a href="#cb64-714" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1000.index, smape_m1000[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-715"><a href="#cb64-715" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-716"><a href="#cb64-716" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-717"><a href="#cb64-717" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-718"><a href="#cb64-718" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-719"><a href="#cb64-719" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-720"><a href="#cb64-720" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-721"><a href="#cb64-721" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-722"><a href="#cb64-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-723"><a href="#cb64-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-724"><a href="#cb64-724" aria-hidden="true" tabindex="-1"></a>O operador SVR-Stack mais uma vez não conseguiu performar para esta série, o valor médio melhor de RMSE e de SMAPE foi 587,052 e 13,44, respectivamente e suas pioras percentuais foram: 854,9% RMSE 1081.019% SMAPE. Fora decidido não usar a escala logarítma, pois esta nõ surtiu efeito em adequar a as medidas para que possibilitasse melhor visualização dos gráficos.</span>
<span id="cb64-725"><a href="#cb64-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-726"><a href="#cb64-726" aria-hidden="true" tabindex="-1"></a>O operador mediana não conseguiu resultados superiores ao valor médio das métricas dos modelos individuais, ficando com erros acima desses. Com exceção da mediana de dois métodos, que é a média simples; *pari passu* ao acresciemento de métodos, o erro adicional crescia.</span>
<span id="cb64-727"><a href="#cb64-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-728"><a href="#cb64-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-729"><a href="#cb64-729" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise dos melhores métodos da série N2401</span></span>
<span id="cb64-730"><a href="#cb64-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-731"><a href="#cb64-731" aria-hidden="true" tabindex="-1"></a>O melhor modelo para as duas métrica foi o SVR. Seu valor de RMSE foi 24,071 e SMAPE 0,375. O que monstra que, semelhante a série N1411, que modelos individuais podem superar combinação. Para o caso da série M10 o melhor modelos foi o Random Forest, que é uma forma de combinação; o que não é caso do Supporte Vector Regressor.</span>
<span id="cb64-732"><a href="#cb64-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-733"><a href="#cb64-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-736"><a href="#cb64-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-737"><a href="#cb64-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n2401_rmse</span></span>
<span id="cb64-738"><a href="#cb64-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N2401 series for RMSE metric'</span></span>
<span id="cb64-739"><a href="#cb64-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-740"><a href="#cb64-740" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-741"><a href="#cb64-741" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-742"><a href="#cb64-742" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-743"><a href="#cb64-743" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-744"><a href="#cb64-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-745"><a href="#cb64-745" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-746"><a href="#cb64-746" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-747"><a href="#cb64-747" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-748"><a href="#cb64-748" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-749"><a href="#cb64-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-750"><a href="#cb64-750" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-751"><a href="#cb64-751" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span>
<span id="cb64-752"><a href="#cb64-752" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-753"><a href="#cb64-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-754"><a href="#cb64-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-757"><a href="#cb64-757" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-758"><a href="#cb64-758" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n2401_smape</span></span>
<span id="cb64-759"><a href="#cb64-759" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N2401 series for SMAPE metric'</span></span>
<span id="cb64-760"><a href="#cb64-760" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-761"><a href="#cb64-761" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-762"><a href="#cb64-762" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-763"><a href="#cb64-763" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-764"><a href="#cb64-764" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1000'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-765"><a href="#cb64-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-766"><a href="#cb64-766" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-767"><a href="#cb64-767" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-768"><a href="#cb64-768" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-769"><a href="#cb64-769" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-770"><a href="#cb64-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-771"><a href="#cb64-771" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-772"><a href="#cb64-772" aria-hidden="true" tabindex="-1"></a>best_models_smape</span>
<span id="cb64-773"><a href="#cb64-773" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-774"><a href="#cb64-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-775"><a href="#cb64-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-776"><a href="#cb64-776" aria-hidden="true" tabindex="-1"></a><span class="fu">#### N2402</span></span>
<span id="cb64-777"><a href="#cb64-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-778"><a href="#cb64-778" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise Geral dos *Ensembles* da Série N2402</span></span>
<span id="cb64-779"><a href="#cb64-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-780"><a href="#cb64-780" aria-hidden="true" tabindex="-1"></a>Divisão em treino e teste da séries MACRO N2402 em @fig-n2402-series</span>
<span id="cb64-781"><a href="#cb64-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-784"><a href="#cb64-784" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-785"><a href="#cb64-785" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "N2402 MACRO Time Series"</span></span>
<span id="cb64-786"><a href="#cb64-786" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap-location: bottom</span></span>
<span id="cb64-787"><a href="#cb64-787" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2402-series</span></span>
<span id="cb64-788"><a href="#cb64-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-789"><a href="#cb64-789" aria-hidden="true" tabindex="-1"></a>m1001 <span class="op">=</span> Y_df[Y_df[<span class="st">"unique_id"</span>] <span class="op">==</span> <span class="st">'M1001'</span>]</span>
<span id="cb64-790"><a href="#cb64-790" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-791"><a href="#cb64-791" aria-hidden="true" tabindex="-1"></a>ax.plot(m1001.ds[:<span class="op">-</span><span class="dv">18</span>], m1001.y[:<span class="op">-</span><span class="dv">18</span>].values, label<span class="op">=</span><span class="st">'Treino'</span>)</span>
<span id="cb64-792"><a href="#cb64-792" aria-hidden="true" tabindex="-1"></a>ax.plot(m1001.ds[<span class="op">-</span><span class="dv">18</span>:], m1001.y[<span class="op">-</span><span class="dv">18</span>:].values, label<span class="op">=</span><span class="st">'Teste'</span>)</span>
<span id="cb64-793"><a href="#cb64-793" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-794"><a href="#cb64-794" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-795"><a href="#cb64-795" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-796"><a href="#cb64-796" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-797"><a href="#cb64-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-798"><a href="#cb64-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-799"><a href="#cb64-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-802"><a href="#cb64-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-803"><a href="#cb64-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-rmse_mean_n2402</span></span>
<span id="cb64-804"><a href="#cb64-804" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average RMSE value for the N2402 by number of model on ensemble."</span></span>
<span id="cb64-805"><a href="#cb64-805" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-806"><a href="#cb64-806" aria-hidden="true" tabindex="-1"></a>rmse_m1001 <span class="op">=</span> mean_rmse_series_models.loc[<span class="st">'M1001'</span>,:]</span>
<span id="cb64-807"><a href="#cb64-807" aria-hidden="true" tabindex="-1"></a>rmse_m1001</span>
<span id="cb64-808"><a href="#cb64-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-809"><a href="#cb64-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-812"><a href="#cb64-812" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-813"><a href="#cb64-813" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-smape_mean_n2402</span></span>
<span id="cb64-814"><a href="#cb64-814" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Group of average SMAPE value for the N2402 by number of model on ensemble."</span></span>
<span id="cb64-815"><a href="#cb64-815" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-816"><a href="#cb64-816" aria-hidden="true" tabindex="-1"></a>smape_m1001 <span class="op">=</span> mean_smape_series_models.loc[<span class="st">'M1001'</span>,:]</span>
<span id="cb64-817"><a href="#cb64-817" aria-hidden="true" tabindex="-1"></a>smape_m1001</span>
<span id="cb64-818"><a href="#cb64-818" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-819"><a href="#cb64-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-820"><a href="#cb64-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-823"><a href="#cb64-823" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-824"><a href="#cb64-824" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2402-rmse</span></span>
<span id="cb64-825"><a href="#cb64-825" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average RMSE values for all combination operators used on N2402 series."</span></span>
<span id="cb64-826"><a href="#cb64-826" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-827"><a href="#cb64-827" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-828"><a href="#cb64-828" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-829"><a href="#cb64-829" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-830"><a href="#cb64-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-831"><a href="#cb64-831" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-832"><a href="#cb64-832" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-833"><a href="#cb64-833" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-834"><a href="#cb64-834" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-835"><a href="#cb64-835" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-836"><a href="#cb64-836" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-837"><a href="#cb64-837" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-838"><a href="#cb64-838" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-839"><a href="#cb64-839" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-840"><a href="#cb64-840" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-841"><a href="#cb64-841" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-842"><a href="#cb64-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-843"><a href="#cb64-843" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-844"><a href="#cb64-844" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-845"><a href="#cb64-845" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-846"><a href="#cb64-846" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_m1001.index, rmse_m1001[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-847"><a href="#cb64-847" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-848"><a href="#cb64-848" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-849"><a href="#cb64-849" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-850"><a href="#cb64-850" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-851"><a href="#cb64-851" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-852"><a href="#cb64-852" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-853"><a href="#cb64-853" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-854"><a href="#cb64-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-855"><a href="#cb64-855" aria-hidden="true" tabindex="-1"></a>A série temporal N2402 é monstrado novamente a dificuldade de generalizar do operador SVR-Stack. Mais uma vez obteve os piores resultados com uma piora de 1201.36% em relação à média do valor RMSE do modelos individuais. A piora percentual pela métrica SMAPE é de 1721.57%.</span>
<span id="cb64-856"><a href="#cb64-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-857"><a href="#cb64-857" aria-hidden="true" tabindex="-1"></a>Analisando individualmente 5 séries seguidas de período sasonal 12 e por previsão one-step ahead forecasting, há indicatívos de não adequação da técnica Stack com meta-modelo SVR para prevêr séries com tais características. É preciso ainda mais estudos individuais e geral com esse operador de combinação para ter melhores evidência se tal combinador é vantajoso para previsão nesse contexto.</span>
<span id="cb64-858"><a href="#cb64-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-859"><a href="#cb64-859" aria-hidden="true" tabindex="-1"></a>Os demais combinadores comportaram-se de modo semelhante aos casos anteriores analisados. A média ponderada obtese os melhores resultados, seguida da média simples e da mediana. </span>
<span id="cb64-860"><a href="#cb64-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-863"><a href="#cb64-863" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-864"><a href="#cb64-864" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-n2402-smape</span></span>
<span id="cb64-865"><a href="#cb64-865" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Average SMAPE values for all combination operators used on N2402 series."</span></span>
<span id="cb64-866"><a href="#cb64-866" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-867"><a href="#cb64-867" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-868"><a href="#cb64-868" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-869"><a href="#cb64-869" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-870"><a href="#cb64-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-871"><a href="#cb64-871" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-872"><a href="#cb64-872" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-873"><a href="#cb64-873" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-874"><a href="#cb64-874" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-875"><a href="#cb64-875" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-876"><a href="#cb64-876" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-877"><a href="#cb64-877" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-878"><a href="#cb64-878" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-879"><a href="#cb64-879" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-880"><a href="#cb64-880" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-881"><a href="#cb64-881" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-882"><a href="#cb64-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-883"><a href="#cb64-883" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-884"><a href="#cb64-884" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-885"><a href="#cb64-885" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-886"><a href="#cb64-886" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_m1001.index, smape_m1001[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-887"><a href="#cb64-887" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-888"><a href="#cb64-888" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-889"><a href="#cb64-889" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-890"><a href="#cb64-890" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-891"><a href="#cb64-891" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-892"><a href="#cb64-892" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-893"><a href="#cb64-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-894"><a href="#cb64-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-895"><a href="#cb64-895" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Análise dos melhores métodos da série N2402</span></span>
<span id="cb64-896"><a href="#cb64-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-899"><a href="#cb64-899" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-900"><a href="#cb64-900" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n2402_rmse</span></span>
<span id="cb64-901"><a href="#cb64-901" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N2402 series for RMSE metric'</span></span>
<span id="cb64-902"><a href="#cb64-902" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-903"><a href="#cb64-903" aria-hidden="true" tabindex="-1"></a>mean<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-904"><a href="#cb64-904" aria-hidden="true" tabindex="-1"></a>median<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-905"><a href="#cb64-905" aria-hidden="true" tabindex="-1"></a>fi_avg<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-906"><a href="#cb64-906" aria-hidden="true" tabindex="-1"></a>stack<span class="op">=</span>rmse[rmse[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'rmse_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'rmse_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-907"><a href="#cb64-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-908"><a href="#cb64-908" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-909"><a href="#cb64-909" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-910"><a href="#cb64-910" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-911"><a href="#cb64-911" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-912"><a href="#cb64-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-913"><a href="#cb64-913" aria-hidden="true" tabindex="-1"></a>best_models_rmse <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-914"><a href="#cb64-914" aria-hidden="true" tabindex="-1"></a>best_models_rmse</span>
<span id="cb64-915"><a href="#cb64-915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-916"><a href="#cb64-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-917"><a href="#cb64-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-920"><a href="#cb64-920" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-921"><a href="#cb64-921" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-best_model_n2402_smape</span></span>
<span id="cb64-922"><a href="#cb64-922" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: 'The Best models for N2402 series for SMAPE metric'</span></span>
<span id="cb64-923"><a href="#cb64-923" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap-location: bottom</span></span>
<span id="cb64-924"><a href="#cb64-924" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_mean'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_mean'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-925"><a href="#cb64-925" aria-hidden="true" tabindex="-1"></a>median <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_median'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_median'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-926"><a href="#cb64-926" aria-hidden="true" tabindex="-1"></a>fi_avg <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_fi_avg'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_fi_avg'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-927"><a href="#cb64-927" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> smape[smape[<span class="st">'dataset'</span>] <span class="op">==</span> <span class="st">'M1001'</span>][[<span class="st">'models_used'</span>,<span class="st">'smape_stack_svr'</span>]].sort_values(by<span class="op">=</span><span class="st">'smape_stack_svr'</span>).iloc[<span class="dv">0</span>,:].values</span>
<span id="cb64-928"><a href="#cb64-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-929"><a href="#cb64-929" aria-hidden="true" tabindex="-1"></a>mean[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(mean[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-930"><a href="#cb64-930" aria-hidden="true" tabindex="-1"></a>median[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(median[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-931"><a href="#cb64-931" aria-hidden="true" tabindex="-1"></a>fi_avg[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(fi_avg[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-932"><a href="#cb64-932" aria-hidden="true" tabindex="-1"></a>stack[<span class="dv">0</span>] <span class="op">=</span> <span class="st">' '</span>.join(stack[<span class="dv">0</span>].upper().split(<span class="st">'_'</span>))</span>
<span id="cb64-933"><a href="#cb64-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-934"><a href="#cb64-934" aria-hidden="true" tabindex="-1"></a>best_models_smape <span class="op">=</span> pd.DataFrame({<span class="st">"Mean"</span>:mean, <span class="st">"Median"</span>:median,<span class="st">"FI weigthed AVG"</span>:fi_avg, <span class="st">"Stack SVR"</span>:stack})</span>
<span id="cb64-935"><a href="#cb64-935" aria-hidden="true" tabindex="-1"></a>best_models_smape</span>
<span id="cb64-936"><a href="#cb64-936" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-937"><a href="#cb64-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-938"><a href="#cb64-938" aria-hidden="true" tabindex="-1"></a>O modelos modelo para a série M1001 foi a combinação por mediana dos modelos MLP-SVR-ARIMA com o RMSE de  41.85 e mediana de MLP-SVR-CES com resultado de 0.4802.</span>
<span id="cb64-939"><a href="#cb64-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-940"><a href="#cb64-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-941"><a href="#cb64-941" aria-hidden="true" tabindex="-1"></a><span class="fu">### Agrupamento do número de modelos, independente da série, por valor RMSE e SMAPE</span></span>
<span id="cb64-942"><a href="#cb64-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-943"><a href="#cb64-943" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Análise Geral</span></span>
<span id="cb64-944"><a href="#cb64-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-945"><a href="#cb64-945" aria-hidden="true" tabindex="-1"></a>Quandos os dados são agrupados para o valor médio do error para a quantidade de modelos combinados (independente das séries histórias), vê-se claramente que média e média ponderada conseguem se sobrepôr aos outros dois combinadores. Stacking, usando meta-modelo o não-linear SVR, piora drasticamente já com dois métodos empilhados quando compara-se aos valores dos modelos individuais e segue até a quantidade 6 de métodos e se estabiliza. Já a mediana tem seu melhor valor com dois métodos no *ensemble*, o que é a mesma coisa da média aritmética, e ocila piorando levemente.</span>
<span id="cb64-946"><a href="#cb64-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-949"><a href="#cb64-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-950"><a href="#cb64-950" aria-hidden="true" tabindex="-1"></a>rmse_group <span class="op">=</span> rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].mean()</span>
<span id="cb64-951"><a href="#cb64-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-952"><a href="#cb64-952" aria-hidden="true" tabindex="-1"></a>rmse_group</span>
<span id="cb64-953"><a href="#cb64-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-954"><a href="#cb64-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-957"><a href="#cb64-957" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-958"><a href="#cb64-958" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmse_group.<span class="bu">round</span>(<span class="dv">3</span>).to_latex())</span>
<span id="cb64-959"><a href="#cb64-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-960"><a href="#cb64-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-963"><a href="#cb64-963" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-964"><a href="#cb64-964" aria-hidden="true" tabindex="-1"></a>smape_group <span class="op">=</span> smape.groupby([<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].mean()</span>
<span id="cb64-965"><a href="#cb64-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-966"><a href="#cb64-966" aria-hidden="true" tabindex="-1"></a>smape_group</span>
<span id="cb64-967"><a href="#cb64-967" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-968"><a href="#cb64-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-969"><a href="#cb64-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-972"><a href="#cb64-972" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-973"><a href="#cb64-973" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(smape_group.<span class="bu">round</span>(<span class="dv">3</span>).to_latex())</span>
<span id="cb64-974"><a href="#cb64-974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-975"><a href="#cb64-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-976"><a href="#cb64-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-979"><a href="#cb64-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-980"><a href="#cb64-980" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mean-rmse</span></span>
<span id="cb64-981"><a href="#cb64-981" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Mean RMSE value for all combination operators by number of models in ensemble"</span></span>
<span id="cb64-982"><a href="#cb64-982" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-983"><a href="#cb64-983" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-984"><a href="#cb64-984" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-985"><a href="#cb64-985" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-986"><a href="#cb64-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-987"><a href="#cb64-987" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-988"><a href="#cb64-988" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-989"><a href="#cb64-989" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-990"><a href="#cb64-990" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-991"><a href="#cb64-991" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group.index, rmse_group[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-992"><a href="#cb64-992" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-993"><a href="#cb64-993" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-994"><a href="#cb64-994" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-995"><a href="#cb64-995" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-996"><a href="#cb64-996" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-997"><a href="#cb64-997" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-998"><a href="#cb64-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-999"><a href="#cb64-999" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-1000"><a href="#cb64-1000" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média '</span>)</span>
<span id="cb64-1001"><a href="#cb64-1001" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Mediana'</span>)</span>
<span id="cb64-1002"><a href="#cb64-1002" aria-hidden="true" tabindex="-1"></a>ax1.plot(rmse_group.index, rmse_group[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-1003"><a href="#cb64-1003" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-1004"><a href="#cb64-1004" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1005"><a href="#cb64-1005" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-1006"><a href="#cb64-1006" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor RMSE'</span>)</span>
<span id="cb64-1007"><a href="#cb64-1007" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-1008"><a href="#cb64-1008" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1009"><a href="#cb64-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1010"><a href="#cb64-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1011"><a href="#cb64-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1014"><a href="#cb64-1014" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1015"><a href="#cb64-1015" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-mean-smape</span></span>
<span id="cb64-1016"><a href="#cb64-1016" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Mean SMAPE value for all combination operators by number of models in ensemble"</span></span>
<span id="cb64-1017"><a href="#cb64-1017" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb64-1018"><a href="#cb64-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "With SVR-Stacking"</span></span>
<span id="cb64-1019"><a href="#cb64-1019" aria-hidden="true" tabindex="-1"></a><span class="co">#|   - "Without SVR-Stacking"</span></span>
<span id="cb64-1020"><a href="#cb64-1020" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-1021"><a href="#cb64-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1022"><a href="#cb64-1022" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-1023"><a href="#cb64-1023" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-1024"><a href="#cb64-1024" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-1025"><a href="#cb64-1025" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-1026"><a href="#cb64-1026" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group.index, smape_group[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-1027"><a href="#cb64-1027" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-1028"><a href="#cb64-1028" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1029"><a href="#cb64-1029" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-1030"><a href="#cb64-1030" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-1031"><a href="#cb64-1031" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-1032"><a href="#cb64-1032" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1033"><a href="#cb64-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1034"><a href="#cb64-1034" aria-hidden="true" tabindex="-1"></a>fig1, ax1 <span class="op">=</span> plt.subplots()</span>
<span id="cb64-1035"><a href="#cb64-1035" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média'</span>)</span>
<span id="cb64-1036"><a href="#cb64-1036" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Mediana'</span>)</span>
<span id="cb64-1037"><a href="#cb64-1037" aria-hidden="true" tabindex="-1"></a>ax1.plot(smape_group.index, smape_group[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Valor Médio do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-1038"><a href="#cb64-1038" aria-hidden="true" tabindex="-1"></a>ax1.grid()</span>
<span id="cb64-1039"><a href="#cb64-1039" aria-hidden="true" tabindex="-1"></a>ax1.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1040"><a href="#cb64-1040" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Número de Modelos Combinados'</span>)</span>
<span id="cb64-1041"><a href="#cb64-1041" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Valor SMAPE'</span>)</span>
<span id="cb64-1042"><a href="#cb64-1042" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb64-1043"><a href="#cb64-1043" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1044"><a href="#cb64-1044" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1045"><a href="#cb64-1045" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1046"><a href="#cb64-1046" aria-hidden="true" tabindex="-1"></a><span class="fu">#### *Box Plots*</span></span>
<span id="cb64-1047"><a href="#cb64-1047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1050"><a href="#cb64-1050" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1051"><a href="#cb64-1051" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplot_rmse</span></span>
<span id="cb64-1052"><a href="#cb64-1052" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Boxplot for mean RMSE value of all combinators."</span></span>
<span id="cb64-1053"><a href="#cb64-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1054"><a href="#cb64-1054" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb64-1055"><a href="#cb64-1055" aria-hidden="true" tabindex="-1"></a>ax.boxplot(rmse_group.loc[<span class="dv">2</span>:,:],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">'SVR-Stacking'</span>])</span>
<span id="cb64-1056"><a href="#cb64-1056" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1057"><a href="#cb64-1057" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'RMSE'</span>)</span>
<span id="cb64-1058"><a href="#cb64-1058" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1059"><a href="#cb64-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1060"><a href="#cb64-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1063"><a href="#cb64-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1064"><a href="#cb64-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplot_smape</span></span>
<span id="cb64-1065"><a href="#cb64-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Boxplot for mean SMAPE value of all combinators."</span></span>
<span id="cb64-1066"><a href="#cb64-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1067"><a href="#cb64-1067" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb64-1068"><a href="#cb64-1068" aria-hidden="true" tabindex="-1"></a>ax.boxplot(smape_group.loc[<span class="dv">2</span>:,:],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">'SVR-Stacking'</span>])</span>
<span id="cb64-1069"><a href="#cb64-1069" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1070"><a href="#cb64-1070" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'SMAPE'</span>)</span>
<span id="cb64-1071"><a href="#cb64-1071" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1072"><a href="#cb64-1072" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1073"><a href="#cb64-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1074"><a href="#cb64-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1077"><a href="#cb64-1077" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1078"><a href="#cb64-1078" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplot_rmse_wout_stack</span></span>
<span id="cb64-1079"><a href="#cb64-1079" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Boxplot for mean RMSE value of mean, weigthed mean and median."</span></span>
<span id="cb64-1080"><a href="#cb64-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1081"><a href="#cb64-1081" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb64-1082"><a href="#cb64-1082" aria-hidden="true" tabindex="-1"></a>ax.boxplot(rmse_group.loc[<span class="dv">2</span>:,[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>]],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>])</span>
<span id="cb64-1083"><a href="#cb64-1083" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1084"><a href="#cb64-1084" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'RMSE'</span>)</span>
<span id="cb64-1085"><a href="#cb64-1085" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1086"><a href="#cb64-1086" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1087"><a href="#cb64-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1090"><a href="#cb64-1090" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1091"><a href="#cb64-1091" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplot_smape_wout_stack</span></span>
<span id="cb64-1092"><a href="#cb64-1092" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Boxplot for mean SMAPE value of mean, weigthed mean and median."</span></span>
<span id="cb64-1093"><a href="#cb64-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1094"><a href="#cb64-1094" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb64-1095"><a href="#cb64-1095" aria-hidden="true" tabindex="-1"></a>ax.boxplot(smape_group.loc[<span class="dv">2</span>:,[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>]],tick_labels<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>])</span>
<span id="cb64-1096"><a href="#cb64-1096" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1097"><a href="#cb64-1097" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'SMAPE'</span>)</span>
<span id="cb64-1098"><a href="#cb64-1098" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1099"><a href="#cb64-1099" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1100"><a href="#cb64-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1101"><a href="#cb64-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1102"><a href="#cb64-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1103"><a href="#cb64-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1104"><a href="#cb64-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1107"><a href="#cb64-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1108"><a href="#cb64-1108" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-boxplots</span></span>
<span id="cb64-1109"><a href="#cb64-1109" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Box plot separados para o RMSE médio dos quatro combinadores para todas séries"</span></span>
<span id="cb64-1110"><a href="#cb64-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1111"><a href="#cb64-1111" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span>  plt.subplots(ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">2</span>, layout<span class="op">=</span><span class="st">'constrained'</span>)</span>
<span id="cb64-1112"><a href="#cb64-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1113"><a href="#cb64-1113" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].boxplot(rmse_group[<span class="st">'rmse_mean'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb64-1114"><a href="#cb64-1114" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1115"><a href="#cb64-1115" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'RMSE médio da Média'</span>)</span>
<span id="cb64-1116"><a href="#cb64-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1117"><a href="#cb64-1117" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].boxplot(rmse_group[<span class="st">'rmse_median'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb64-1118"><a href="#cb64-1118" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1119"><a href="#cb64-1119" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'RMSE médio da Mediana'</span>)</span>
<span id="cb64-1120"><a href="#cb64-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1121"><a href="#cb64-1121" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].boxplot(rmse_group[<span class="st">'rmse_fi_avg'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb64-1122"><a href="#cb64-1122" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1123"><a href="#cb64-1123" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'RMSE médio da Média Ponderada'</span>)</span>
<span id="cb64-1124"><a href="#cb64-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1125"><a href="#cb64-1125" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].boxplot(rmse_group[<span class="st">'rmse_stack_svr'</span>].values, patch_artist<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb64-1126"><a href="#cb64-1126" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1127"><a href="#cb64-1127" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'RMSE médio do Stacking'</span>)</span>
<span id="cb64-1128"><a href="#cb64-1128" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1129"><a href="#cb64-1129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1130"><a href="#cb64-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1131"><a href="#cb64-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Análise de Dispersão</span></span>
<span id="cb64-1132"><a href="#cb64-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1133"><a href="#cb64-1133" aria-hidden="true" tabindex="-1"></a>Uma caracteristica importante que se detecta usando os gráficos @fig-std-rmse e @fig-std-smape é que quanto mais modelos são adicionados à combinação, o desvio padrão dos valores médios dos error RMSE e SMAPE caem. Variância e desvio padrão são métricas de dispersão que indicam certa robustês nos dos modelos; usando a analogia do alvo e dos dardos, modelos que baixa variância/desvio padrão tendem a acertar mais num ponto. </span>
<span id="cb64-1134"><a href="#cb64-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1135"><a href="#cb64-1135" aria-hidden="true" tabindex="-1"></a>Modelos com dispersão menor têm menor incerteza para acerto, o que torna o desvio padrão uma métrica importantíssima para setores como finanças. E ao que os dados indicam que para séries temporais mensais há a tendência de diminuição do desvio padrão ao passo que mais modelos são adicionados.   </span>
<span id="cb64-1136"><a href="#cb64-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1139"><a href="#cb64-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1140"><a href="#cb64-1140" aria-hidden="true" tabindex="-1"></a>rmse_group_std <span class="op">=</span> rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].std()</span>
<span id="cb64-1141"><a href="#cb64-1141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1142"><a href="#cb64-1142" aria-hidden="true" tabindex="-1"></a>rmse_group_std</span>
<span id="cb64-1143"><a href="#cb64-1143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1146"><a href="#cb64-1146" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1147"><a href="#cb64-1147" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-std-rmse</span></span>
<span id="cb64-1148"><a href="#cb64-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Desvio Padrão do RMSE para os quatro operadores de combinação"</span></span>
<span id="cb64-1149"><a href="#cb64-1149" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-1150"><a href="#cb64-1150" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1151"><a href="#cb64-1151" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-1152"><a href="#cb64-1152" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_mean'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Média'</span>)</span>
<span id="cb64-1153"><a href="#cb64-1153" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_median'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Mediana'</span>)</span>
<span id="cb64-1154"><a href="#cb64-1154" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para Média Ponderada'</span>)</span>
<span id="cb64-1155"><a href="#cb64-1155" aria-hidden="true" tabindex="-1"></a>ax.plot(rmse_group_std.index, rmse_group_std[<span class="st">'rmse_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do RMSE para SVR-Stacking'</span>)</span>
<span id="cb64-1156"><a href="#cb64-1156" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos'</span>)</span>
<span id="cb64-1157"><a href="#cb64-1157" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Desvio Padrão RMSE'</span>)</span>
<span id="cb64-1158"><a href="#cb64-1158" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-1159"><a href="#cb64-1159" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1160"><a href="#cb64-1160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1161"><a href="#cb64-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1164"><a href="#cb64-1164" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1165"><a href="#cb64-1165" aria-hidden="true" tabindex="-1"></a>smape_group_std <span class="op">=</span> smape.groupby([<span class="st">'n_models'</span>])[[<span class="st">'smape_mean'</span>,<span class="st">'smape_median'</span>,<span class="st">'smape_fi_avg'</span>,<span class="st">'smape_stack_svr'</span>]].std()</span>
<span id="cb64-1166"><a href="#cb64-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1167"><a href="#cb64-1167" aria-hidden="true" tabindex="-1"></a>smape_group_std</span>
<span id="cb64-1168"><a href="#cb64-1168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1169"><a href="#cb64-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1172"><a href="#cb64-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1173"><a href="#cb64-1173" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-std-smape</span></span>
<span id="cb64-1174"><a href="#cb64-1174" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Desvio Padrão do SMAPE para os quatro operadores de combinação"</span></span>
<span id="cb64-1175"><a href="#cb64-1175" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb64-1176"><a href="#cb64-1176" aria-hidden="true" tabindex="-1"></a>ax.set_facecolor(<span class="st">'#E9ECEF'</span>)</span>
<span id="cb64-1177"><a href="#cb64-1177" aria-hidden="true" tabindex="-1"></a>ax.grid()</span>
<span id="cb64-1178"><a href="#cb64-1178" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_mean'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão SMAPE para Média'</span>)</span>
<span id="cb64-1179"><a href="#cb64-1179" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_median'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para Mediana'</span>)</span>
<span id="cb64-1180"><a href="#cb64-1180" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_fi_avg'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para Média Ponderada'</span>)</span>
<span id="cb64-1181"><a href="#cb64-1181" aria-hidden="true" tabindex="-1"></a>ax.plot(smape_group_std.index, smape_group_std[<span class="st">'smape_stack_svr'</span>].values, label<span class="op">=</span><span class="st">'Desvio Padrão do SMAPE para SVR-Stacking'</span>)</span>
<span id="cb64-1182"><a href="#cb64-1182" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Número de Modelos'</span>)</span>
<span id="cb64-1183"><a href="#cb64-1183" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Desvio Padrão SMAPE'</span>)</span>
<span id="cb64-1184"><a href="#cb64-1184" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb64-1185"><a href="#cb64-1185" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1186"><a href="#cb64-1186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1187"><a href="#cb64-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1188"><a href="#cb64-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1191"><a href="#cb64-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1192"><a href="#cb64-1192" aria-hidden="true" tabindex="-1"></a>rmse.groupby([<span class="st">'n_models'</span>])[[<span class="st">'rmse_mean'</span>,<span class="st">'rmse_median'</span>,<span class="st">'rmse_fi_avg'</span>,<span class="st">'rmse_stack_svr'</span>]].agg([<span class="st">'mean'</span>,<span class="st">'std'</span>])</span>
<span id="cb64-1193"><a href="#cb64-1193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1194"><a href="#cb64-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1195"><a href="#cb64-1195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1196"><a href="#cb64-1196" aria-hidden="true" tabindex="-1"></a><span class="fu">## Análise de Teste de Hipótese Friedman/Nemenyi</span></span>
<span id="cb64-1197"><a href="#cb64-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1198"><a href="#cb64-1198" aria-hidden="true" tabindex="-1"></a>Após o teste de Friedman --- o qual verifica se há diferenças entre os métodos --- com significância de 5%, foi possível rejeitar a hipótese nula para ambas métricas, o *post hoc* de Nemenyi idenficou o nível de diferença entre as populações, baseda na distância crítica CD de 0.303 para a meétrics RMSE e SMAPE, há evidências que corroboboram com a afirmação de que método WAFI é mais acurado que os demais. Os gráficos @fig-cd mostram o *ranking* dos modelos.</span>
<span id="cb64-1199"><a href="#cb64-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1202"><a href="#cb64-1202" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1203"><a href="#cb64-1203" aria-hidden="true" tabindex="-1"></a>dc_rmse <span class="op">=</span> pd.DataFrame(mean_rmse_series_models.loc[(<span class="bu">slice</span>(<span class="va">None</span>) , <span class="bu">slice</span>(<span class="dv">2</span>,<span class="dv">9</span>)) , :].values, columns<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">"SVR-Stacking"</span>])</span>
<span id="cb64-1204"><a href="#cb64-1204" aria-hidden="true" tabindex="-1"></a>rmse_result <span class="op">=</span> autorank(dc_rmse, alpha<span class="op">=</span><span class="fl">0.05</span>, verbose<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span><span class="st">'ascending'</span>)</span>
<span id="cb64-1205"><a href="#cb64-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1206"><a href="#cb64-1206" aria-hidden="true" tabindex="-1"></a>dc_smape <span class="op">=</span> pd.DataFrame(mean_smape_series_models.loc[(<span class="bu">slice</span>(<span class="va">None</span>) , <span class="bu">slice</span>(<span class="dv">2</span>,<span class="dv">9</span>)) , :].values, columns<span class="op">=</span>[<span class="st">'Média Simples'</span>, <span class="st">'Mediana'</span>, <span class="st">'Média Ponderada'</span>, <span class="st">"SVR Stacking"</span>])</span>
<span id="cb64-1207"><a href="#cb64-1207" aria-hidden="true" tabindex="-1"></a>smape_result <span class="op">=</span> autorank(dc_smape, alpha<span class="op">=</span><span class="fl">0.05</span>, verbose<span class="op">=</span><span class="va">False</span>, order<span class="op">=</span><span class="st">'ascending'</span>)</span>
<span id="cb64-1208"><a href="#cb64-1208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1209"><a href="#cb64-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1212"><a href="#cb64-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1213"><a href="#cb64-1213" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(create_report(rmse_result))</span>
<span id="cb64-1214"><a href="#cb64-1214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1215"><a href="#cb64-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1218"><a href="#cb64-1218" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1219"><a href="#cb64-1219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(create_report(smape_result))</span>
<span id="cb64-1220"><a href="#cb64-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1221"><a href="#cb64-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1224"><a href="#cb64-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb64-1225"><a href="#cb64-1225" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cd</span></span>
<span id="cb64-1226"><a href="#cb64-1226" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Diagramas de Distância Crítica para as métricas RMSE e SMAPE"</span></span>
<span id="cb64-1227"><a href="#cb64-1227" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap: </span></span>
<span id="cb64-1228"><a href="#cb64-1228" aria-hidden="true" tabindex="-1"></a><span class="co">#|    - "CD RSME"</span></span>
<span id="cb64-1229"><a href="#cb64-1229" aria-hidden="true" tabindex="-1"></a><span class="co">#|    - "CD SMAPE"</span></span>
<span id="cb64-1230"><a href="#cb64-1230" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-nrow: 2</span></span>
<span id="cb64-1231"><a href="#cb64-1231" aria-hidden="true" tabindex="-1"></a>plot_stats(rmse_result)</span>
<span id="cb64-1232"><a href="#cb64-1232" aria-hidden="true" tabindex="-1"></a>plot_stats(smape_result)</span>
<span id="cb64-1233"><a href="#cb64-1233" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb64-1234"><a href="#cb64-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copiar para a área de transferência" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.captionPrefix || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        if (captionSpan !== null) {
          let captionPrefix = el.dataset.captionPrefix + " ";
          let captionNumber = "";
          if (el.dataset.pseudocodeNumber) {
            captionNumber = el.dataset.pseudocodeNumber + " ";
            if (el.dataset.chapterLevel) {
              captionNumber = el.dataset.chapterLevel + "." + captionNumber;
            }
          }
          captionSpan.innerHTML = captionPrefix + captionNumber;
        }
      });
    })(document);
    </script>
  




</body></html>